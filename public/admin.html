<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
  <meta http-equiv="Pragma" content="no-cache">
  <meta http-equiv="Expires" content="0">
  <meta name="version" content="v2.1.0">
  <title>ìš´ì˜ì§„ ê´€ë¦¬ - ì˜¤ì‚°ê³  71íšŒ ë™ê¸° ì†¡ë…„íšŒ</title>
  <script src="https://cdn.tailwindcss.com"></script>
  
  <!-- Firebase SDK & Config -->
  <script type="module">
    // Firebase ì„¤ì • íŒŒì¼ ë¡œë“œ
    import('./js/firebase-config.js')
      .then(() => {
        console.log('âœ… Firebase ì„¤ì • ë¡œë“œ ì™„ë£Œ');
        // Firebase Manager ì‚¬ìš© ê°€ëŠ¥ ì•Œë¦¼
        if (window.firebaseManager) {
          console.log('ğŸ”¥ Firebase Manager ì¤€ë¹„ë¨');
        }
      })
      .catch(error => {
        console.error('âŒ Firebase ì„¤ì • ë¡œë“œ ì‹¤íŒ¨:', error);
      });
  </script>
  
  <style>
    body { font-family: -apple-system, BlinkMacSystemFont, "Segue UI", "Noto Sans KR", sans-serif; }
    
    /* Firebase ì—°ê²° ìƒíƒœ í‘œì‹œ */
    .firebase-status {
      position: fixed;
      top: 70px;
      right: 20px;
      z-index: 40;
      padding: 8px 12px;
      border-radius: 20px;
      font-size: 12px;
      font-weight: 600;
      transition: all 0.3s ease;
    }
    
    .status-online { background: #10b981; color: white; }
    .status-offline { background: #f59e0b; color: white; }
    .status-syncing { background: #3b82f6; color: white; animation: pulse 2s infinite; }
    
    @keyframes pulse {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.7; }
    }
  </style>
</head>
<body class="bg-gradient-to-br from-blue-900 via-blue-700 to-slate-900 min-h-screen">
  
  <!-- Firebase ì—°ê²° ìƒíƒœ í‘œì‹œ -->
  <div id="firebaseStatus" class="firebase-status status-syncing">
    <span id="firebaseStatusText">ğŸ”„ Firebase ì—°ê²°ì¤‘...</span>
  </div>
  
  <!-- ë„¤ë¹„ê²Œì´ì…˜ ë°” -->
  <nav class="fixed top-0 left-0 right-0 z-50 bg-black bg-opacity-80 backdrop-blur-md border-b border-slate-600 shadow-lg">
    <div class="max-w-7xl mx-auto px-2 sm:px-4">
      <div class="flex justify-between items-center h-16">
        <div class="flex items-center space-x-2 sm:space-x-4">
          <img src="images/osan_log3.svg" alt="ì˜¤ì‚°ê³  ë¡œê³ " class="w-8 h-8 sm:w-12 sm:h-12 object-contain">
          <h1 class="text-white font-bold text-sm sm:text-lg drop-shadow-sm">ì˜¤ì‚°ê³  71íšŒ ì†¡ë…„íšŒ</h1>
        </div>
        
        <!-- ë°ìŠ¤í¬í†± ë©”ë‰´ -->
        <div class="hidden lg:flex space-x-2">
          <!-- í•µì‹¬ ê¸°ëŠ¥ -->
          <a href="/invitation" class="px-3 py-2 rounded-lg text-sm font-semibold text-slate-200 hover:text-white hover:bg-slate-700 transition-colors">
            ğŸŠ ì´ˆëŒ€ì¥
          </a>
          <a href="/checkin" class="px-3 py-2 rounded-lg text-sm font-semibold text-slate-200 hover:text-white hover:bg-slate-700 transition-colors">
            ğŸ“ ì²´í¬ì¸
          </a>
          <a href="/admin" class="px-3 py-2 rounded-lg text-sm font-semibold bg-purple-600 text-white shadow-sm">
            âš™ï¸ ê´€ë¦¬
          </a>
          
          <!-- ê´€ë¦¬ì ë„êµ¬ -->
          <div class="border-l border-slate-600 pl-2 ml-2"></div>
          <a href="debug.html" class="px-3 py-2 rounded-lg text-sm font-semibold text-blue-300 hover:text-white hover:bg-blue-600 transition-colors">
            ğŸ”§ ë””ë²„ê·¸
          </a>
          
          <!-- ë¶€ê°€ ê¸°ëŠ¥ -->
          <div class="border-l border-slate-600 pl-2 ml-2"></div>
          <a href="/screenshot" class="px-3 py-2 rounded-lg text-sm font-semibold text-slate-200 hover:text-white hover:bg-slate-700 transition-colors">
            ğŸ“¸ ìŠ¤í¬ë¦°ìƒ·
          </a>
          <a href="/screenshot-jp" class="px-3 py-2 rounded-lg text-sm font-semibold text-slate-200 hover:text-white hover:bg-slate-700 transition-colors">
            ğŸ‡¯ğŸ‡µ æ—¥æœ¬èª
          </a>
          <button onclick="toggleSchoolSong()" class="px-3 py-2 rounded-lg text-sm font-semibold text-slate-200 hover:text-white hover:bg-slate-700 transition-colors">
            ğŸµ êµê°€
          </button>
        </div>

        <!-- ì¤‘ê°„ í¬ê¸° í™”ë©´ìš© ì¶•ì•½ ë©”ë‰´ -->
        <div class="hidden md:flex lg:hidden space-x-2">
          <a href="/invitation" class="px-3 py-2 rounded-lg text-sm font-semibold text-slate-200 hover:text-white hover:bg-slate-700 transition-colors">
            ğŸŠ
          </a>
          <a href="/checkin" class="px-3 py-2 rounded-lg text-sm font-semibold text-slate-200 hover:text-white hover:bg-slate-700 transition-colors">
            ğŸ“
          </a>
          <a href="/admin" class="px-3 py-2 rounded-lg text-sm font-semibold bg-purple-600 text-white shadow-sm">
            âš™ï¸
          </a>
          <a href="debug.html" class="px-3 py-2 rounded-lg text-sm font-semibold text-blue-300 hover:text-white hover:bg-blue-600 transition-colors">
            ğŸ”§
          </a>
        </div>
        
        <!-- í–„ë²„ê±° ë©”ë‰´ ë²„íŠ¼ -->
        <button id="hamburger-btn" class="md:hidden text-white p-2 rounded-lg hover:bg-slate-700 transition-colors">
          <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path>
          </svg>
        </button>
      </div>
    </div>
    
    <!-- ëª¨ë°”ì¼ ë©”ë‰´ (ìˆ¨ê²¨ì§„ ìƒíƒœ) -->
    <div id="mobile-menu" class="md:hidden bg-black bg-opacity-95 border-t border-slate-600 hidden">
      <div class="px-4 py-2 space-y-1">
        
        <!-- í•µì‹¬ ê¸°ëŠ¥ ê·¸ë£¹ -->
        <div class="text-xs font-bold text-slate-400 uppercase tracking-wide px-4 py-2 border-b border-slate-700">
          í•µì‹¬ ê¸°ëŠ¥
        </div>
        <a href="/invitation" class="block px-4 py-3 rounded-lg text-sm font-semibold text-slate-200 hover:text-white hover:bg-slate-700 transition-colors text-center">
          ğŸŠ ì´ˆëŒ€ì¥
        </a>
        <a href="/checkin" class="block px-4 py-3 rounded-lg text-sm font-semibold text-slate-200 hover:text-white hover:bg-slate-700 transition-colors text-center">
          ğŸ“ ì²´í¬ì¸
        </a>
        <a href="/admin" class="block px-4 py-3 rounded-lg text-sm font-semibold bg-purple-600 text-white text-center">
          âš™ï¸ ê´€ë¦¬ì (í˜„ì¬ í˜ì´ì§€)
        </a>
        
        <!-- ê´€ë¦¬ì ë„êµ¬ ê·¸ë£¹ -->
        <div class="text-xs font-bold text-slate-400 uppercase tracking-wide px-4 py-2 border-b border-slate-700 mt-4">
          ê´€ë¦¬ì ë„êµ¬
        </div>
        <a href="debug.html" class="block px-4 py-3 rounded-lg text-sm font-semibold text-blue-300 hover:text-white hover:bg-blue-600 transition-colors text-center">
          ğŸ”§ ë””ë²„ê·¸ & ë¶„ì„
        </a>
        
        <!-- ë¶€ê°€ ê¸°ëŠ¥ ê·¸ë£¹ -->
        <div class="text-xs font-bold text-slate-400 uppercase tracking-wide px-4 py-2 border-b border-slate-700 mt-4">
          ë¶€ê°€ ê¸°ëŠ¥
        </div>
        <a href="/screenshot" class="block px-4 py-3 rounded-lg text-sm font-semibold text-slate-200 hover:text-white hover:bg-slate-700 transition-colors text-center">
          ğŸ“¸ ìŠ¤í¬ë¦°ìƒ·
        </a>
        <a href="/screenshot-jp" class="block px-4 py-3 rounded-lg text-sm font-semibold text-slate-200 hover:text-white hover:bg-slate-700 transition-colors text-center">
          ğŸ‡¯ğŸ‡µ æ—¥æœ¬èª í˜ì´ì§€
        </a>
        <button onclick="toggleSchoolSong()" class="block w-full px-4 py-3 rounded-lg text-sm font-semibold text-slate-200 hover:text-white hover:bg-slate-700 transition-colors text-center">
          ğŸµ êµê°€ ë“£ê¸°
        </button>
        
        <!-- ì‹œìŠ¤í…œ ì •ë³´ -->
        <div class="text-xs text-slate-500 text-center px-4 py-3 border-t border-slate-700 mt-4">
          <div>ì˜¤ì‚°ê³  71íšŒ ë™ê¸° ì†¡ë…„íšŒ</div>
          <div class="mt-1">ê´€ë¦¬ì ì‹œìŠ¤í…œ v2.1.0</div>
        </div>
      </div>
    </div>
  </nav>

  <!-- ë©”ì¸ ì»¨í…ì¸  -->
  <div class="pt-16 px-2 sm:px-4 pb-4">
    <div class="max-w-6xl mx-auto">
      <!-- í—¤ë” -->
      <header class="mb-4 sm:mb-6 md:mb-8">
        <div class="text-center mb-6">
          <h1 class="text-xl sm:text-2xl md:text-4xl font-bold text-white mb-2">ì˜¤ì‚°ê³  71íšŒ ë™ê¸° ì†¡ë…„íšŒ</h1>
          <h2 class="text-lg sm:text-xl md:text-2xl font-semibold text-blue-300 mb-4">ìš´ì˜ì§„ ëŒ€ì‹œë³´ë“œ</h2>
        </div>
        
        <!-- ê´€ë¦¬ì ë¹ ë¥¸ ì•¡ì…˜ ë²„íŠ¼ë“¤ -->
        <div class="mb-6 flex flex-wrap justify-center gap-2 sm:gap-4">
          <a href="debug.html" class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg font-semibold text-sm transition-colors">
            ğŸ”§ ì‹œìŠ¤í…œ ë””ë²„ê·¸
          </a>
          <button onclick="refreshAllData()" class="bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-lg font-semibold text-sm transition-colors">
            ğŸ”„ ë°ì´í„° ìƒˆë¡œê³ ì¹¨
          </button>
          <button onclick="exportAttendees()" class="bg-indigo-600 hover:bg-indigo-700 text-white px-4 py-2 rounded-lg font-semibold text-sm transition-colors">
            ğŸ“¤ ëª…ë‹¨ ë‚´ë³´ë‚´ê¸°
          </button>
          <button onclick="showQuickStats()" class="bg-purple-600 hover:bg-purple-700 text-white px-4 py-2 rounded-lg font-semibold text-sm transition-colors">
            ğŸ“Š ë¹ ë¥¸ í†µê³„
          </button>
        </div>
        
        <div class="bg-blue-800 bg-opacity-50 rounded-lg p-4 text-center">
          <p class="text-white text-lg">
            ì´ <span id="totalCount" class="font-bold text-yellow-300">0ëª…</span> ì¤‘ 
            <span id="checkedInCount" class="font-bold text-green-300">0ëª…</span> ì²´í¬ì¸ ì™„ë£Œ
          </p>
        </div>
      </header>

      <div class="grid grid-cols-1 lg:grid-cols-3 gap-4 sm:gap-6">
        <!-- ì°¸ì„ì ì¶”ê°€ ì„¹ì…˜ -->
        <div class="bg-white bg-opacity-10 backdrop-blur-sm rounded-xl p-4 sm:p-6 border border-blue-500">
          <h3 class="text-xl font-semibold text-white mb-4">ì°¸ì„ì ì¶”ê°€</h3>
          <div class="space-y-4">
            <input
              type="text"
              id="newName"
              placeholder="ì´ë¦„"
              class="w-full p-3 rounded-lg bg-slate-800 text-white border border-slate-600 focus:border-blue-400 focus:outline-none"
            />
            <input
              type="text"
              id="newPhone"
              placeholder="ì „í™”ë²ˆí˜¸ (ì„ íƒì‚¬í•­)"
              class="w-full p-3 rounded-lg bg-slate-800 text-white border border-slate-600 focus:border-blue-400 focus:outline-none"
            />
            <button
              onclick="addAttendee()"
              class="w-full bg-blue-600 hover:bg-blue-700 text-white font-semibold py-3 px-4 rounded-lg transition-colors"
            >
              ì¶”ê°€
            </button>
          </div>
        </div>

        <!-- ì•¡ì…˜ ë²„íŠ¼ ì„¹ì…˜ -->
        <div class="bg-white bg-opacity-10 backdrop-blur-sm rounded-xl p-6 border border-green-500">
          <h3 class="text-xl font-semibold text-white mb-4">ëª…ë‹¨ ê´€ë¦¬</h3>
          <div class="space-y-3">
            <button
              onclick="copyToClipboard()"
              class="w-full bg-green-600 hover:bg-green-700 text-white font-semibold py-3 px-4 rounded-lg transition-colors"
            >
              ğŸ“‹ í´ë¦½ë³´ë“œ ë³µì‚¬
            </button>
            <button
              onclick="exportToCSV()"
              class="w-full bg-purple-600 hover:bg-purple-700 text-white font-semibold py-3 px-4 rounded-lg transition-colors"
            >
              ğŸ“ CSV ë‹¤ìš´ë¡œë“œ
            </button>
            <button
              onclick="clearAllData()"
              class="w-full bg-red-600 hover:bg-red-700 text-white font-semibold py-3 px-4 rounded-lg transition-colors"
            >
              ğŸ—‘ï¸ ì „ì²´ ì´ˆê¸°í™”
            </button>
            <button
              onclick="clearCache()"
              class="w-full bg-orange-600 hover:bg-orange-700 text-white font-semibold py-3 px-4 rounded-lg transition-colors"
            >
              ğŸ”„ ìºì‹œ ì´ˆê¸°í™”
            </button>
            <button
              onclick="exportDataForSharing()"
              class="w-full bg-blue-600 hover:bg-blue-700 text-white font-semibold py-3 px-4 rounded-lg transition-colors"
            >
              ğŸ“± ë°ì´í„° ê³µìœ 
            </button>
            <button
              onclick="importSharedData()"
              class="w-full bg-green-600 hover:bg-green-700 text-white font-semibold py-3 px-4 rounded-lg transition-colors"
            >
              ğŸ“² ë°ì´í„° ê°€ì ¸ì˜¤ê¸°
            </button>
            <div class="text-sm text-slate-300 mt-4 p-3 bg-slate-800 rounded-lg">
              <p class="mb-1">ğŸ’¡ <strong>ì‚¬ìš©ë²•:</strong></p>
              <p class="text-xs">â€¢ ì²´í¬ì¸ ë²„íŠ¼ìœ¼ë¡œ ì¶œì„ ê´€ë¦¬</p>
              <p class="text-xs">â€¢ ì‚­ì œ ë²„íŠ¼ìœ¼ë¡œ ê°œë³„ ì œê±°</p>
              <p class="text-xs">â€¢ ë³µì‚¬/ë‹¤ìš´ë¡œë“œë¡œ ëª…ë‹¨ ë°±ì—…</p>
              <p class="text-xs text-red-300">â€¢ âš ï¸ ì „ì²´ ì´ˆê¸°í™”ëŠ” ì‹ ì¤‘íˆ ì‚¬ìš©</p>
              <p class="text-xs text-orange-300">â€¢ ğŸ”„ ìºì‹œ ì´ˆê¸°í™”ëŠ” ëª¨ë°”ì¼ ë°ì´í„° ë¬¸ì œ ì‹œ</p>
              <p class="text-xs text-blue-300">â€¢ ğŸ“± ë°ì´í„° ê³µìœ ë¡œ ë‹¤ë¥¸ ë””ë°”ì´ìŠ¤ì— ë³µì‚¬</p>
              <p class="text-xs text-green-300">â€¢ ğŸ“² ë°ì´í„° ê°€ì ¸ì˜¤ê¸°ë¡œ ì—…ë°ì´íŠ¸</p>
            </div>
          </div>
        </div>

        <!-- í†µê³„ ì„¹ì…˜ -->
        <div class="bg-white bg-opacity-10 backdrop-blur-sm rounded-xl p-6 border border-yellow-500">
          <h3 class="text-xl font-semibold text-white mb-4">ì‹¤ì‹œê°„ í˜„í™©</h3>
          <div class="space-y-3">
            <div class="bg-slate-800 rounded-lg p-3">
              <p class="text-yellow-300 font-semibold">ì²´í¬ì¸ í˜„í™©</p>
              <p id="progressText" class="text-2xl font-bold text-white">0 / 0</p>
              <div class="w-full bg-slate-700 rounded-full h-2 mt-2">
                <div id="progressBar" class="bg-gradient-to-r from-green-400 to-blue-500 h-2 rounded-full transition-all duration-500" style="width: 0%"></div>
              </div>
            </div>
            <div class="bg-slate-800 rounded-lg p-3">
              <p class="text-blue-300 font-semibold">ì™„ë£Œìœ¨</p>
              <p id="completionRate" class="text-2xl font-bold text-white">0%</p>
            </div>
          </div>
        </div>
      </div>

      <!-- ì°¸ì„ì ëª…ë‹¨ -->
      <div class="mt-8 bg-white bg-opacity-10 backdrop-blur-sm rounded-xl p-4 sm:p-6 border border-slate-500">
        <div class="flex justify-between items-center mb-4">
          <h3 class="text-xl font-semibold text-white">ì°¸ì„ì ëª…ë‹¨</h3>
          <div class="flex items-center gap-4">
            <select id="sortOption" onchange="sortAttendees()" class="bg-slate-700 text-white text-sm px-3 py-1 rounded border border-slate-600 focus:border-blue-400">
              <option value="name">ì´ë¦„ìˆœ</option>
              <option value="checkin">ì²´í¬ì¸ìˆœ</option>
              <option value="time">ë“±ë¡ìˆœ</option>
            </select>
            <div class="text-sm text-slate-300">
              <span id="listCount">0ëª…</span> í‘œì‹œì¤‘
            </div>
          </div>
        </div>
        <div class="overflow-x-auto max-h-96 overflow-y-auto border border-slate-600 rounded-lg">
          <table class="w-full text-white text-sm">
            <thead class="bg-slate-800 sticky top-0">
              <tr class="border-b border-slate-600">
                <th class="text-left py-2 px-2 font-semibold">ì´ë¦„</th>
                <th class="text-left py-2 px-2 font-semibold hidden sm:table-cell">ì „í™”ë²ˆí˜¸</th>
                <th class="text-center py-2 px-2 font-semibold">ìƒíƒœ</th>
                <th class="text-center py-2 px-2 font-semibold hidden md:table-cell">ì²´í¬ì¸ ì‹œê°„</th>
                <th class="text-center py-2 px-2 font-semibold">ì•¡ì…˜</th>
              </tr>
            </thead>
            <tbody id="attendeesList">
              <tr id="emptyMessage">
                <td colspan="5" class="text-center py-8 text-slate-400">
                  <div class="mb-2">ğŸ¯ ì•„ì§ ë“±ë¡ëœ ì°¸ì„ìê°€ ì—†ìŠµë‹ˆë‹¤</div>
                  <div class="text-xs text-slate-500">
                    ì¢Œì¸¡ "ì°¸ì„ì ì¶”ê°€" ì„¹ì…˜ì—ì„œ ì´ë¦„ì„ ì…ë ¥í•˜ì—¬<br>
                    ì°¸ì„ìë¥¼ ë“±ë¡í•´ë³´ì„¸ìš”!
                  </div>
                </td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
    </div>
  </div>

  <!-- êµê°€ ëª¨ë‹¬ -->
  <div id="schoolSongModal" class="fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-50 hidden">
    <div class="bg-white bg-opacity-10 backdrop-blur-sm rounded-2xl p-6 m-4 max-w-lg w-full max-h-[80vh] overflow-y-auto border border-blue-500">
      <div class="text-center mb-4">
        <h2 class="text-2xl font-bold text-white mb-2">ğŸµ ì˜¤ì‚°ê³  êµê°€</h2>
        <p class="text-blue-300 text-sm">ë‹¤ì„¯ ë«¼ì˜ ì•„ì´ë“¤</p>
      </div>
      
      <div class="space-y-4 text-white">
        <!-- 1ì ˆ -->
        <div class="bg-blue-800 bg-opacity-30 rounded-lg p-4">
          <h3 class="text-lg font-semibold text-yellow-300 mb-2">1ì ˆ</h3>
          <p class="leading-relaxed text-sm">
            ë„¤ ëˆˆì´ ë°êµ¬ë‚˜ ì—‘ìŠ¤ë¹›ê°™ë‹¤<br>
            í•˜ëŠ˜ì„ ê¿°ëš«ê³  ë•…ì„ ë“¤ì¶”ì–´<br>
            ì˜¨ê°€ì§€ ì§„ë¦¬ë¥¼ ìºê³  ë§ë ¨ë‹¤<br>
            <strong class="text-blue-200">ë„¤ê°€ ì°¸ ë‹¤ì„¯ ë«¼ì˜ ì•„ì´ë¡œêµ¬ë‚˜</strong>
          </p>
        </div>
        
        <!-- 2ì ˆ -->
        <div class="bg-blue-800 bg-opacity-30 rounded-lg p-4">
          <h3 class="text-lg font-semibold text-yellow-300 mb-2">2ì ˆ</h3>
          <p class="leading-relaxed text-sm">
            ë„¤ ì†ì´ ì†”ê°‘ê³  í˜ë„ í¬êµ¬ë‚˜<br>
            ë¶ˆê¸¸ë„ ë§Œì§€ê³  ëŒë„ ì£¼ë¬¼ëŸ¬<br>
            ìƒˆë¡œìš´ ëˆ„ë¦¬ë¥¼ ì§“ê³  ë§ë ¨ë‹¤<br>
            <strong class="text-blue-200">ë„¤ê°€ ì°¸ ë‹¤ì„¯ ë«¼ì˜ ì•„ì´ë¡œêµ¬ë‚˜</strong>
          </p>
        </div>
        
        <!-- 3ì ˆ -->
        <div class="bg-blue-800 bg-opacity-30 rounded-lg p-4">
          <h3 class="text-lg font-semibold text-yellow-300 mb-2">3ì ˆ</h3>
          <p class="leading-relaxed text-sm">
            ë„¤ ë§˜ì´ ë§‘êµ¬ë‚˜ ì˜ˆë¯¼ë„ í•˜ë‹¤<br>
            í•˜ëŠ˜ê³¼ ë•… ì‚¬ì´ ë¯¸ë¬˜í•œ ê²ƒì´<br>
            ê±°ìš¸ì— ë” ë§‘ê²Œ ë¹„ì¹˜ëŠ”êµ¬ë‚˜<br>
            <strong class="text-blue-200">ë„¤ê°€ ì°¸ ë‹¤ì„¯ ë«¼ì˜ ì•„ì´ë¡œêµ¬ë‚˜</strong>
          </p>
        </div>
        
        <!-- 4ì ˆ -->
        <div class="bg-blue-800 bg-opacity-30 rounded-lg p-4">
          <h3 class="text-lg font-semibold text-yellow-300 mb-2">4ì ˆ</h3>
          <p class="leading-relaxed text-sm">
            ë„¤ ì¸ê²© ë†’êµ¬ë‚˜ ì •ì„±ê³¼ ì‚¬ë‘<br>
            ë„¤ ì†ë°œ ê°€ëŠ”ë° í™”í‰ì´ ìˆê³ <br>
            ë¬´ì‹¬í•œ ë¯¸ë¬¼ë„ ë‹¤ ë¯¿ëŠ”êµ¬ë‚˜<br>
            <strong class="text-blue-200">ë„¤ê°€ ì°¸ ë‹¤ì„¯ ë«¼ì˜ ì•„ì´ë¡œêµ¬ë‚˜</strong>
          </p>
        </div>
      </div>
      
      <div class="mt-6 text-center">
        <button onclick="toggleSchoolSong()" class="bg-purple-600 hover:bg-purple-700 text-white font-semibold py-3 px-6 rounded-lg transition-colors">
          ë‹«ê¸°
        </button>
      </div>
    </div>
  </div>

  <script>
    let attendees = [];
    let firebaseUnsubscribe = null; // ì‹¤ì‹œê°„ ë¦¬ìŠ¤ë„ˆ í•´ì œìš©

    // Firebase ìƒíƒœ ì—…ë°ì´íŠ¸ í•¨ìˆ˜
    function updateFirebaseStatus(status, message) {
      const statusElement = document.getElementById('firebaseStatus');
      const statusText = document.getElementById('firebaseStatusText');
      
      if (statusElement && statusText) {
        statusElement.className = `firebase-status status-${status}`;
        statusText.textContent = message;
      }
    }

    // Firebaseì—ì„œ ì‹¤ì‹œê°„ ë°ì´í„° ë¡œë“œ
    async function loadAttendeesFromFirebase() {
      if (!window.firebaseManager) {
        console.warn('Firebase Managerê°€ ì—†ìŠµë‹ˆë‹¤. localStorageë¥¼ ì‚¬ìš©í•©ë‹ˆë‹¤.');
        return loadAttendeesFromLocalStorage();
      }

      try {
        updateFirebaseStatus('syncing', 'ğŸ”„ ë°ì´í„° ë¡œë”©ì¤‘...');
        
        // ì‹¤ì‹œê°„ ë¦¬ìŠ¤ë„ˆ ì„¤ì •
        firebaseUnsubscribe = window.firebaseManager.onAttendeesUpdate((firebaseAttendees) => {
          attendees = firebaseAttendees.map(a => ({
            id: a.id,
            name: a.name || '',
            phone: a.phone || '',
            checkedIn: a.checkedIn || false,
            checkedInAt: a.checkedInAt || '',
            timestamp: a.timestamp
          }));
          
          sortAttendees();
          updateStats();
          updateFirebaseStatus('online', `âœ… ì‹¤ì‹œê°„ ì—°ê²° (${attendees.length}ëª…)`);
          console.log('ğŸ”¥ Firebase ì‹¤ì‹œê°„ ë°ì´í„° ì—…ë°ì´íŠ¸:', attendees.length);
        });

      } catch (error) {
        console.error('Firebase ë°ì´í„° ë¡œë“œ ì˜¤ë¥˜:', error);
        updateFirebaseStatus('offline', 'âŒ Firebase ì˜¤ë¥˜');
        loadAttendeesFromLocalStorage(); // ë°±ì—…ìœ¼ë¡œ localStorage ì‚¬ìš©
      }
    }

    // localStorageì—ì„œ ë°ì´í„° ë¡œë“œ (ë°±ì—…ìš©)
    function loadAttendeesFromLocalStorage() {
      const saved = localStorage.getItem('attendees');
      if (saved) {
        attendees = JSON.parse(saved);
      } else {
        attendees = [];
      }
      sortAttendees();
      updateFirebaseStatus('offline', `âš ï¸ ì˜¤í”„ë¼ì¸ (${attendees.length}ëª…)`);
    }

    // í˜ì´ì§€ ë¡œë“œ ì‹œ ë°ì´í„° ë¶ˆëŸ¬ì˜¤ê¸°
    async function loadAttendees() {
      // Firebase Managerê°€ ë¡œë“œë  ë•Œê¹Œì§€ ëŒ€ê¸°
      let retryCount = 0;
      const maxRetries = 10;
      
      const waitForFirebase = () => {
        if (window.firebaseManager) {
          return loadAttendeesFromFirebase();
        } else if (retryCount < maxRetries) {
          retryCount++;
          setTimeout(() => waitForFirebase(), 500);
        } else {
          console.warn('Firebase ë¡œë“œ ì‹œê°„ ì´ˆê³¼');
          loadAttendeesFromLocalStorage();
        }
      };
      
      waitForFirebase();
    }

    function saveAttendees() {
      localStorage.setItem('attendees', JSON.stringify(attendees));
      // ìºì‹œ ë²„ì „ ì—…ë°ì´íŠ¸ë¡œ ë‹¤ë¥¸ í˜ì´ì§€ì— ë³€ê²½ ì•Œë¦¼
      localStorage.setItem('cacheVersion', Date.now().toString());
    }

    async function addAttendee() {
      const name = document.getElementById('newName').value.trim();
      const phone = document.getElementById('newPhone').value.trim();
      
      if (!name) {
        alert('ì´ë¦„ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
        return;
      }

      try {
        if (window.firebaseManager) {
          updateFirebaseStatus('syncing', 'ğŸ”„ ì¶”ê°€ì¤‘...');
          
          const attendeeData = {
            name: name,
            phone: phone || '',
            checkedIn: false,
            checkedInAt: '',
            timestamp: new Date()
          };
          
          await window.firebaseManager.addAttendee(attendeeData);
          updateFirebaseStatus('online', `âœ… ì¶”ê°€ì™„ë£Œ (${attendees.length + 1}ëª…)`);
          
        } else {
          // Firebaseê°€ ì—†ì„ ê²½ìš° localStorage ì‚¬ìš©
          const newAttendee = {
            id: Date.now().toString(),
            name: name,
            phone: phone || '',
            checkedIn: false
          };
          attendees.push(newAttendee);
          saveAttendees();
          sortAttendees();
        }
        
        // ì…ë ¥ í•„ë“œ ì´ˆê¸°í™”
        document.getElementById('newName').value = '';
        document.getElementById('newPhone').value = '';
        
      } catch (error) {
        console.error('ì°¸ì„ì ì¶”ê°€ ì˜¤ë¥˜:', error);
        updateFirebaseStatus('offline', 'âŒ ì¶”ê°€ ì‹¤íŒ¨');
        alert('ì°¸ì„ì ì¶”ê°€ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
      }
    }

    async function removeAttendee(id) {
      if (!confirm('ì •ë§ë¡œ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
        return;
      }

      try {
        if (window.firebaseManager) {
          updateFirebaseStatus('syncing', 'ğŸ”„ ì‚­ì œì¤‘...');
          await window.firebaseManager.deleteAttendee(id);
          // ì‹¤ì‹œê°„ ë¦¬ìŠ¤ë„ˆê°€ ìë™ìœ¼ë¡œ UI ì—…ë°ì´íŠ¸
        } else {
          // localStorage ë°±ì—…
          attendees = attendees.filter(a => a.id !== id);
          saveAttendees();
          sortAttendees();
        }
      } catch (error) {
        console.error('ì°¸ì„ì ì‚­ì œ ì˜¤ë¥˜:', error);
        updateFirebaseStatus('offline', 'âŒ ì‚­ì œ ì‹¤íŒ¨');
        alert('ì‚­ì œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
      }
    }

    async function toggleCheckIn(id) {
      try {
        const attendee = attendees.find(a => a.id === id);
        if (!attendee) return;

        if (window.firebaseManager) {
          updateFirebaseStatus('syncing', 'ğŸ”„ ì—…ë°ì´íŠ¸ì¤‘...');
          
          const updates = {
            checkedIn: !attendee.checkedIn,
            checkedInAt: !attendee.checkedIn ? new Date().toLocaleString('ko-KR') : ''
          };
          
          await window.firebaseManager.updateAttendee(id, updates);
          // ì‹¤ì‹œê°„ ë¦¬ìŠ¤ë„ˆê°€ ìë™ìœ¼ë¡œ UI ì—…ë°ì´íŠ¸
        } else {
          // localStorage ë°±ì—…
          attendees = attendees.map(a => 
            a.id === id 
              ? { 
                  ...a, 
                  checkedIn: !a.checkedIn, 
                  checkedInAt: !a.checkedIn ? new Date().toLocaleString('ko-KR') : '' 
                }
              : a
          );
          saveAttendees();
          sortAttendees();
        }
      } catch (error) {
        console.error('ì²´í¬ì¸ í† ê¸€ ì˜¤ë¥˜:', error);
        updateFirebaseStatus('offline', 'âŒ ì—…ë°ì´íŠ¸ ì‹¤íŒ¨');
        alert('ì²´í¬ì¸ ìƒíƒœ ë³€ê²½ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
      }
    }

    function sortAttendees() {
      const sortOption = document.getElementById('sortOption').value;
      
      switch(sortOption) {
        case 'name':
          attendees.sort((a, b) => a.name.localeCompare(b.name, 'ko'));
          break;
        case 'checkin':
          attendees.sort((a, b) => {
            if (a.checkedIn === b.checkedIn) {
              return a.name.localeCompare(b.name, 'ko');
            }
            return b.checkedIn - a.checkedIn; // ì²´í¬ì¸ ì™„ë£Œê°€ ë¨¼ì €
          });
          break;
        case 'time':
          attendees.sort((a, b) => {
            const timeA = a.checkedInAt || a.registeredAt || '0';
            const timeB = b.checkedInAt || b.registeredAt || '0';
            return timeB.localeCompare(timeA); // ìµœì‹ ìˆœ
          });
          break;
      }
      
      renderAttendees();
      saveAttendees();
    }

    function renderAttendees() {
      const tbody = document.getElementById('attendeesList');
      const emptyMessage = document.getElementById('emptyMessage');
      
      if (attendees.length === 0) {
        emptyMessage.style.display = 'table-row';
      } else {
        emptyMessage.style.display = 'none';
        
        const rows = attendees.map(attendee => `
          <tr class="border-b border-slate-700 hover:bg-white hover:bg-opacity-5">
            <td class="py-2 px-2 font-semibold">
              <div>${attendee.name}</div>
              <div class="text-xs text-slate-400 sm:hidden">${attendee.phone || ''}</div>
            </td>
            <td class="py-2 px-2 text-slate-300 hidden sm:table-cell">${attendee.phone || '-'}</td>
            <td class="py-2 px-2 text-center">
              <span class="px-2 py-1 rounded-full text-xs font-semibold ${
                attendee.checkedIn 
                  ? 'bg-green-600 text-white' 
                  : 'bg-slate-600 text-slate-300'
              }">
                ${attendee.checkedIn ? 'âœ“' : 'â—‹'}
              </span>
              <div class="text-xs text-slate-400 mt-1 md:hidden">
                ${attendee.checkedInAt ? attendee.checkedInAt.split(' ')[1] : ''}
              </div>
            </td>
            <td class="py-2 px-2 text-center text-xs text-slate-300 hidden md:table-cell">
              ${attendee.checkedInAt || '-'}
            </td>
            <td class="py-2 px-2 text-center">
              <div class="flex flex-col sm:flex-row justify-center space-y-1 sm:space-y-0 sm:space-x-1">
                <button
                  onclick="toggleCheckIn('${attendee.id}')"
                  class="px-2 py-1 rounded text-xs font-semibold transition-colors ${
                    attendee.checkedIn
                      ? 'bg-yellow-600 hover:bg-yellow-700 text-white'
                      : 'bg-green-600 hover:bg-green-700 text-white'
                  }"
                >
                  ${attendee.checkedIn ? 'ì·¨ì†Œ' : 'ì²´í¬ì¸'}
                </button>
                <button
                  onclick="removeAttendee('${attendee.id}')"
                  class="px-2 py-1 bg-red-600 hover:bg-red-700 text-white rounded text-xs font-semibold transition-colors"
                >
                  ì‚­ì œ
                </button>
              </div>
            </td>
          </tr>
        `).join('');
        
        tbody.innerHTML = emptyMessage.outerHTML + rows;
      }
      
      updateStats();
    }

    function updateStats() {
      const total = attendees.length;
      const checkedIn = attendees.filter(a => a.checkedIn).length;
      const rate = total > 0 ? Math.round((checkedIn / total) * 100) : 0;
      
      document.getElementById('totalCount').textContent = total + 'ëª…';
      document.getElementById('checkedInCount').textContent = checkedIn + 'ëª…';
      document.getElementById('progressText').textContent = `${checkedIn} / ${total}`;
      document.getElementById('completionRate').textContent = rate + '%';
      document.getElementById('progressBar').style.width = rate + '%';
      document.getElementById('listCount').textContent = total + 'ëª…';
    }

    function copyToClipboard() {
      const text = attendees.map(a => 
        `${a.name}\t${a.phone || ''}\t${a.checkedIn ? 'ì™„ë£Œ' : 'ë¯¸ì™„ë£Œ'}\t${a.checkedInAt || ''}`
      ).join('\n');
      
      navigator.clipboard.writeText(`ì´ë¦„\tì „í™”ë²ˆí˜¸\tì²´í¬ì¸ ì—¬ë¶€\tì²´í¬ì¸ ì‹œê°„\n${text}`)
        .then(() => alert('ëª…ë‹¨ì´ í´ë¦½ë³´ë“œì— ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤!'))
        .catch(() => alert('ë³µì‚¬ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.'));
    }

    function exportToCSV() {
      const headers = ['ì´ë¦„', 'ì „í™”ë²ˆí˜¸', 'ì²´í¬ì¸ ì—¬ë¶€', 'ì²´í¬ì¸ ì‹œê°„'];
      const rows = attendees.map(a => [
        a.name,
        a.phone || '',
        a.checkedIn ? 'ì™„ë£Œ' : 'ë¯¸ì™„ë£Œ',
        a.checkedInAt || ''
      ]);
      
      const csvContent = [headers, ...rows]
        .map(row => row.map(field => `"${field}"`).join(','))
        .join('\n');
      
      const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
      const link = document.createElement('a');
      const url = URL.createObjectURL(blob);
      link.setAttribute('href', url);
      link.setAttribute('download', `ì†¡ë…„íšŒ_ì°¸ì„ìëª…ë‹¨_${new Date().toISOString().split('T')[0]}.csv`);
      link.click();
    }

    function clearAllData() {
      if (attendees.length === 0) {
        alert('ì´ˆê¸°í™”í•  ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.');
        return;
      }

      const confirmMessage = `ì •ë§ë¡œ ëª¨ë“  ì°¸ì„ì ë°ì´í„°ë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?\n\ní˜„ì¬ ë“±ë¡ëœ ì¸ì›: ${attendees.length}ëª…\nì²´í¬ì¸ ì™„ë£Œ: ${attendees.filter(a => a.checkedIn).length}ëª…\n\nâš ï¸ ì´ ì‘ì—…ì€ ë˜ëŒë¦´ ìˆ˜ ì—†ìŠµë‹ˆë‹¤!`;
      
      if (confirm(confirmMessage)) {
        // ì¶”ê°€ í™•ì¸
        const finalConfirm = confirm('ë§ˆì§€ë§‰ í™•ì¸ì…ë‹ˆë‹¤.\nì •ë§ë¡œ ì „ì²´ ë°ì´í„°ë¥¼ ì´ˆê¸°í™”í•˜ì‹œê² ìŠµë‹ˆê¹Œ?');
        if (finalConfirm) {
          attendees = [];
          localStorage.removeItem('attendees');
          renderAttendees();
          updateStats();
          alert('âœ… ëª¨ë“  ë°ì´í„°ê°€ ì´ˆê¸°í™”ë˜ì—ˆìŠµë‹ˆë‹¤.');
        }
      }
    }

    function clearCache() {
      if (confirm('ëª¨ë“  ìºì‹œë¥¼ ì™„ì „íˆ ì´ˆê¸°í™”í•©ë‹ˆë‹¤.\n- ë¸Œë¼ìš°ì € ìºì‹œ\n- localStorage ë°ì´í„°\n- ì„¸ì…˜ ë°ì´í„°\n\nê³„ì†í•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
        try {
          // 1. ëª¨ë“  localStorage ë°ì´í„° ë°±ì—…
          const attendeesBackup = localStorage.getItem('attendees');
          
          // 2. ì „ì²´ localStorage í´ë¦¬ì–´
          localStorage.clear();
          
          // 3. attendees ë°ì´í„°ë§Œ ë³µì› (ìµœì‹  ë²„ì „ìœ¼ë¡œ)
          if (attendeesBackup) {
            localStorage.setItem('attendees', attendeesBackup);
          }
          
          // 4. ìƒˆë¡œìš´ ìºì‹œ ë²„ì „ ì„¤ì •
          const newVersion = Date.now().toString();
          localStorage.setItem('cacheVersion', newVersion);
          localStorage.setItem('forceReload', 'true');
          
          // 5. ì„¸ì…˜ ìŠ¤í† ë¦¬ì§€ í´ë¦¬ì–´
          sessionStorage.clear();
          sessionStorage.setItem('pageVersion', newVersion);
          
          // 6. ì„œë¹„ìŠ¤ ì›Œì»¤ ì™„ì „ ì œê±°
          if ('serviceWorker' in navigator) {
            navigator.serviceWorker.getRegistrations().then(function(registrations) {
              registrations.forEach(function(registration) {
                registration.unregister();
              });
            });
          }
          
          // 7. ë¸Œë¼ìš°ì € ìºì‹œ ì™„ì „ ì‚­ì œ
          if ('caches' in window) {
            caches.keys().then(function(names) {
              names.forEach(function(name) {
                caches.delete(name);
              });
            });
          }
          
          // 8. ì¿ í‚¤ ì‚­ì œ ì‹œë„
          document.cookie.split(";").forEach(function(c) { 
            document.cookie = c.replace(/^ +/, "").replace(/=.*/, "=;expires=" + new Date().toUTCString() + ";path=/"); 
          });
          
          alert('âœ… ìºì‹œê°€ ì™„ì „íˆ ì´ˆê¸°í™”ë˜ì—ˆìŠµë‹ˆë‹¤!\n\nğŸ“± ëª¨ë°”ì¼ì—ì„œë„:\n1. ë¸Œë¼ìš°ì € ì„¤ì • > ìºì‹œ ì‚­ì œ\n2. ë˜ëŠ” ì‹œí¬ë¦¿/ì‚¬ìƒí™œ ë³´í˜¸ ëª¨ë“œë¡œ ì ‘ì†í•˜ì„¸ìš”.');
          
          // 9. URLì— íƒ€ì„ìŠ¤íƒ¬í”„ ì¶”ê°€í•˜ì—¬ ê°•ì œ ë¦¬ë¡œë“œ
          const url = new URL(window.location.href);
          url.searchParams.set('_t', Date.now());
          window.location.href = url.toString();
          
        } catch (error) {
          console.error('ìºì‹œ í´ë¦¬ì–´ ì¤‘ ì˜¤ë¥˜:', error);
          alert('âŒ ìºì‹œ í´ë¦¬ì–´ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.\nìˆ˜ë™ìœ¼ë¡œ ë¸Œë¼ìš°ì € ì„¤ì •ì—ì„œ ìºì‹œë¥¼ ì‚­ì œí•´ì£¼ì„¸ìš”.');
        }
      }
    }

    // í–‰ì‚¬ ë‹¹ì¼ ë°ì´í„° ê³µìœ  ê¸°ëŠ¥
    function exportDataForSharing() {
      if (attendees.length === 0) {
        alert('ê³µìœ í•  ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.');
        return;
      }
      
      const dataToShare = {
        attendees: attendees,
        exportTime: new Date().toLocaleString('ko-KR'),
        version: 'v2.1.0'
      };
      
      const dataString = JSON.stringify(dataToShare, null, 2);
      
      // í´ë¦½ë³´ë“œì— ë³µì‚¬
      navigator.clipboard.writeText(dataString).then(() => {
        alert(`ğŸ“‹ ë°ì´í„°ê°€ í´ë¦½ë³´ë“œì— ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤!\n\nğŸ“Š ì´ ${attendees.length}ëª…ì˜ ë°ì´í„°\nâ° ${dataToShare.exportTime}\n\në‹¤ë¥¸ ë””ë°”ì´ìŠ¤ì—ì„œ "ë°ì´í„° ê°€ì ¸ì˜¤ê¸°"ë¥¼ ì‚¬ìš©í•˜ì—¬ ë¶™ì—¬ë„£ìœ¼ì„¸ìš”.`);
      }).catch(() => {
        // í´ë¦½ë³´ë“œ ì‹¤íŒ¨ ì‹œ í…ìŠ¤íŠ¸ ì˜ì—­ì— í‘œì‹œ
        const textarea = document.createElement('textarea');
        textarea.value = dataString;
        textarea.style.position = 'fixed';
        textarea.style.opacity = '0';
        document.body.appendChild(textarea);
        textarea.select();
        document.execCommand('copy');
        document.body.removeChild(textarea);
        
        alert('ğŸ“‹ ë°ì´í„°ê°€ í´ë¦½ë³´ë“œì— ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤!\n(ìˆ˜ë™ ë³µì‚¬ ë°©ì‹ìœ¼ë¡œ ì²˜ë¦¬ë¨)');
      });
    }

    function importSharedData() {
      const dataString = prompt('ë‹¤ë¥¸ ë””ë°”ì´ìŠ¤ì—ì„œ ë³µì‚¬í•œ ë°ì´í„°ë¥¼ ë¶™ì—¬ë„£ìœ¼ì„¸ìš”:\n\n(ì „ì²´ JSON ë°ì´í„°ë¥¼ ë¶™ì—¬ë„£ì–´ì£¼ì„¸ìš”)');
      
      if (!dataString) return;
      
      try {
        const importedData = JSON.parse(dataString);
        
        if (!importedData.attendees || !Array.isArray(importedData.attendees)) {
          throw new Error('ì˜¬ë°”ë¥´ì§€ ì•Šì€ ë°ì´í„° í˜•ì‹ì…ë‹ˆë‹¤.');
        }
        
        const importCount = importedData.attendees.length;
        const exportTime = importedData.exportTime || 'ì•Œ ìˆ˜ ì—†ìŒ';
        
        if (confirm(`ë°ì´í„°ë¥¼ ê°€ì ¸ì˜¤ì‹œê² ìŠµë‹ˆê¹Œ?\n\nğŸ“Š ê°€ì ¸ì˜¬ ë°ì´í„°: ${importCount}ëª…\nâ° ë‚´ë³´ë‚¸ ì‹œê°„: ${exportTime}\n\nâš ï¸ í˜„ì¬ ë°ì´í„°(${attendees.length}ëª…)ê°€ ë®ì–´ì“°ì—¬ì§‘ë‹ˆë‹¤!`)) {
          attendees = importedData.attendees;
          saveAttendees();
          
          // ìºì‹œ ë²„ì „ ì—…ë°ì´íŠ¸ë¡œ ë‹¤ë¥¸ í˜ì´ì§€ ë™ê¸°í™”
          localStorage.setItem('cacheVersion', Date.now().toString());
          
          renderAttendees();
          updateStats();
          
          alert(`âœ… ë°ì´í„° ê°€ì ¸ì˜¤ê¸° ì™„ë£Œ!\n\nğŸ“Š ì´ ${importCount}ëª…ì˜ ë°ì´í„°ê°€ ë¡œë“œë˜ì—ˆìŠµë‹ˆë‹¤.\nâ° ì›ë³¸ ì‹œê°„: ${exportTime}`);
        }
        
      } catch (error) {
        alert('âŒ ë°ì´í„° í˜•ì‹ì´ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤.\n\nì˜¬ë°”ë¥¸ JSON í˜•ì‹ì˜ ë°ì´í„°ë¥¼ ë¶™ì—¬ë„£ì–´ì£¼ì„¸ìš”.');
        console.error('ë°ì´í„° ê°€ì ¸ì˜¤ê¸° ì˜¤ë¥˜:', error);
      }
    }

    // Enter í‚¤ë¡œ ì¶”ê°€ ê¸°ëŠ¥
    document.getElementById('newName').addEventListener('keypress', function(e) {
      if (e.key === 'Enter') addAttendee();
    });
    
    document.getElementById('newPhone').addEventListener('keypress', function(e) {
      if (e.key === 'Enter') addAttendee();
    });

    // ê°•ë ¥í•œ ìºì‹œ ë²„ì „ ì²´í¬ ë° ìƒˆë¡œê³ ì¹¨ ê¸°ëŠ¥
    function checkCacheVersion() {
      const currentVersion = localStorage.getItem('cacheVersion');
      const pageVersion = sessionStorage.getItem('pageVersion');
      const forceReload = localStorage.getItem('forceReload');
      
      // ê°•ì œ ë¦¬ë¡œë“œ í”Œë˜ê·¸ê°€ ìˆìœ¼ë©´ ì¦‰ì‹œ ë¦¬ë¡œë“œ
      if (forceReload === 'true') {
        localStorage.removeItem('forceReload');
        const url = new URL(window.location.href);
        url.searchParams.set('_cache', Date.now());
        window.location.replace(url.toString());
        return;
      }
      
      if (currentVersion && currentVersion !== pageVersion) {
        sessionStorage.setItem('pageVersion', currentVersion);
        console.log('ìºì‹œ ì—…ë°ì´íŠ¸ ê°ì§€ - ë°ì´í„° ìƒˆë¡œê³ ì¹¨');
        // ë°ì´í„° ìƒˆë¡œê³ ì¹¨
        updateDataAndUI();
      }
    }

    // ë°ì´í„° ì—…ë°ì´íŠ¸ ë° ìƒˆë¡œê³ ì¹¨
    function updateDataAndUI() {
      loadAttendees();
      renderAttendees();
      updateStats();
    }

    // êµê°€ ëª¨ë‹¬ í† ê¸€ ê¸°ëŠ¥
    function toggleSchoolSong() {
        const modal = document.getElementById('schoolSongModal');
        if (modal) {
            modal.classList.toggle('hidden');
            
            // ëª¨ë‹¬ì´ ì—´ë¦´ ë•Œ ëª¨ë°”ì¼ ë©”ë‰´ ë‹«ê¸°
            const mobileMenu = document.getElementById('mobile-menu');
            if (!modal.classList.contains('hidden') && mobileMenu) {
                mobileMenu.classList.add('hidden');
                const hamburgerBtn = document.getElementById('hamburger-btn');
                if (hamburgerBtn) {
                    const svg = hamburgerBtn.querySelector('svg path');
                    if (svg) {
                        svg.setAttribute('d', 'M4 6h16M4 12h16M4 18h16');
                    }
                }
            }
        }
    }

    // ëª¨ë‹¬ ì™¸ë¶€ í´ë¦­ ì‹œ ë‹«ê¸°
    document.addEventListener('click', function(event) {
        const modal = document.getElementById('schoolSongModal');
        const modalContent = modal?.querySelector('.bg-white');
        
        if (modal && !modal.classList.contains('hidden') && 
            event.target === modal && !modalContent?.contains(event.target)) {
            toggleSchoolSong();
        }
    });

    // í–„ë²„ê±° ë©”ë‰´ í† ê¸€ ê¸°ëŠ¥
    function initializeHamburgerMenu() {
        const hamburgerBtn = document.getElementById('hamburger-btn');
        const mobileMenu = document.getElementById('mobile-menu');
        
        if (hamburgerBtn && mobileMenu) {
            hamburgerBtn.addEventListener('click', function() {
                mobileMenu.classList.toggle('hidden');
                
                // ì•„ì´ì½˜ ë³€ê²½ (í–„ë²„ê±° <-> X)
                const svg = hamburgerBtn.querySelector('svg path');
                if (mobileMenu.classList.contains('hidden')) {
                    svg.setAttribute('d', 'M4 6h16M4 12h16M4 18h16');
                } else {
                    svg.setAttribute('d', 'M6 18L18 6M6 6l12 12');
                }
            });
            
            // ëª¨ë°”ì¼ ë©”ë‰´ ë§í¬ í´ë¦­ ì‹œ ë©”ë‰´ ë‹«ê¸°
            const mobileLinks = mobileMenu.querySelectorAll('a');
            mobileLinks.forEach(link => {
                link.addEventListener('click', function() {
                    mobileMenu.classList.add('hidden');
                    const svg = hamburgerBtn.querySelector('svg path');
                    svg.setAttribute('d', 'M4 6h16M4 12h16M4 18h16');
                });
            });
        }
    }
    
    // í˜ì´ì§€ ë¡œë“œ ì‹œ ì‹¤í–‰
    window.addEventListener('load', function() {
        // Firebase ì´ˆê¸°í™” ë° ë°ì´í„° ë¡œë“œ
        loadAttendees();
        
        // ë„¤íŠ¸ì›Œí¬ ìƒíƒœ ëª¨ë‹ˆí„°ë§
        window.addEventListener('online', () => {
          if (window.firebaseManager) {
            updateFirebaseStatus('online', `âœ… ì˜¨ë¼ì¸ (${attendees.length}ëª…)`);
          }
        });
        
        window.addEventListener('offline', () => {
          updateFirebaseStatus('offline', `âš ï¸ ì˜¤í”„ë¼ì¸ (${attendees.length}ëª…)`);
        });
        
        // í–„ë²„ê±° ë©”ë‰´ ì´ˆê¸°í™”
        initializeHamburgerMenu();
        // ì´ˆê¸° ìºì‹œ ë²„ì „ ì„¤ì •
        if (!sessionStorage.getItem('pageVersion')) {
          sessionStorage.setItem('pageVersion', Date.now().toString());
        }
        
        updateDataAndUI();
      
      // ì£¼ê¸°ì ìœ¼ë¡œ ìºì‹œ ë²„ì „ ì²´í¬ (ê´€ë¦¬ì í˜ì´ì§€ëŠ” ë” ìì£¼)
      setInterval(checkCacheVersion, 2000);
      checkCacheVersion();
      
      // ì£¼ê¸°ì ìœ¼ë¡œ ìºì‹œ ì²´í¬
      setInterval(checkCacheVersion, 5000);
    });

    // ë¹ ë¥¸ ì•¡ì…˜ ë²„íŠ¼ ê¸°ëŠ¥ë“¤
    
    // ì „ì²´ ë°ì´í„° ìƒˆë¡œê³ ì¹¨
    async function refreshAllData() {
      try {
        updateFirebaseStatus('syncing', 'ğŸ”„ ìƒˆë¡œê³ ì¹¨ ì¤‘...');
        
        if (window.firebaseManager) {
          // Firebase ë°ì´í„° ë‹¤ì‹œ ë¡œë“œ
          const freshData = await window.firebaseManager.getAttendees();
          attendees = freshData.map(a => ({
            id: a.id,
            name: a.name || '',
            phone: a.phone || '',
            checkedIn: a.checkedIn || false,
            checkedInAt: a.checkedInAt || '',
            timestamp: a.timestamp
          }));
          
          sortAttendees();
          updateFirebaseStatus('online', `âœ… ìƒˆë¡œê³ ì¹¨ ì™„ë£Œ (${attendees.length}ëª…)`);
          
          // ì„±ê³µ ì•Œë¦¼
          const notification = document.createElement('div');
          notification.className = 'fixed top-20 right-4 bg-green-600 text-white px-4 py-2 rounded-lg shadow-lg z-50';
          notification.textContent = `âœ… ${attendees.length}ëª…ì˜ ë°ì´í„°ê°€ ìƒˆë¡œê³ ì¹¨ë˜ì—ˆìŠµë‹ˆë‹¤.`;
          document.body.appendChild(notification);
          
          setTimeout(() => {
            notification.style.opacity = '0';
            setTimeout(() => document.body.removeChild(notification), 300);
          }, 3000);
          
        } else {
          throw new Error('Firebase Managerê°€ ì—°ê²°ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤');
        }
      } catch (error) {
        console.error('ë°ì´í„° ìƒˆë¡œê³ ì¹¨ ì˜¤ë¥˜:', error);
        updateFirebaseStatus('offline', 'âŒ ìƒˆë¡œê³ ì¹¨ ì‹¤íŒ¨');
        alert(`ìƒˆë¡œê³ ì¹¨ ì‹¤íŒ¨: ${error.message}`);
      }
    }

    // ë¹ ë¥¸ í†µê³„ í‘œì‹œ
    function showQuickStats() {
      const total = attendees.length;
      const checkedIn = attendees.filter(a => a.checkedIn).length;
      const pending = total - checkedIn;
      const checkInRate = total > 0 ? Math.round((checkedIn / total) * 100) : 0;
      
      // ë°ì´í„° íƒ€ì…ë³„ ë¶„ë¥˜ (Firebase ì—°ë™ í›„ íƒœê·¸ ì •ë³´ í™œìš©)
      const realData = attendees.filter(a => a.dataType === 'REAL_DATA').length;
      const sampleData = attendees.filter(a => a.dataType === 'SAMPLE_DATA').length;
      const otherData = total - realData - sampleData;
      
      // ì˜¤ëŠ˜ ì²´í¬ì¸í•œ ì‚¬ëŒë“¤
      const today = new Date().toDateString();
      const todayCheckins = attendees.filter(a => {
        if (!a.checkedInAt) return false;
        const checkinDate = new Date(a.checkedInAt).toDateString();
        return checkinDate === today && a.checkedIn;
      }).length;

      const statsMessage = `
ğŸ“Š ì‹¤ì‹œê°„ ì°¸ì„ í˜„í™©

ğŸ‘¥ ì´ ì°¸ì„ì: ${total}ëª…
âœ… ì²´í¬ì¸ ì™„ë£Œ: ${checkedIn}ëª… (${checkInRate}%)
â° ëŒ€ê¸° ì¤‘: ${pending}ëª…

ğŸ“ˆ ë°ì´í„° êµ¬ì„±
â€¢ ì‹¤ì œ ë°ì´í„°: ${realData}ëª…
â€¢ ìƒ˜í”Œ ë°ì´í„°: ${sampleData}ëª…  
â€¢ ê¸°íƒ€ ë°ì´í„°: ${otherData}ëª…

ğŸ“… ì˜¤ëŠ˜ ì²´í¬ì¸: ${todayCheckins}ëª…

ğŸ”¥ Firebase ì—°ê²°: ${window.firebaseManager ? 'ì •ìƒ' : 'ì˜¤ë¥˜'}
ğŸ’¾ ë¡œì»¬ ë°±ì—…: ${localStorage.getItem('attendees') ? 'ìˆìŒ' : 'ì—†ìŒ'}

ìµœì¢… ì—…ë°ì´íŠ¸: ${new Date().toLocaleString('ko-KR')}
      `;

      alert(statsMessage);
    }

    // í–¥ìƒëœ ëª…ë‹¨ ë‚´ë³´ë‚´ê¸°
    function exportAttendees() {
      if (attendees.length === 0) {
        alert('ë‚´ë³´ë‚¼ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.');
        return;
      }

      try {
        // CSV í˜•ì‹ìœ¼ë¡œ ë°ì´í„° ì¤€ë¹„
        const csvHeader = 'ë²ˆí˜¸,ì´ë¦„,ì—°ë½ì²˜,ì²´í¬ì¸ì—¬ë¶€,ì²´í¬ì¸ì‹œê°„,ë°ì´í„°íƒ€ì…,ë“±ë¡ì‹œê°„\n';
        const csvContent = attendees.map((attendee, index) => {
          return [
            index + 1,
            `"${attendee.name || ''}"`,
            `"${attendee.phone || ''}"`,
            attendee.checkedIn ? 'ì²´í¬ì¸ì™„ë£Œ' : 'ëŒ€ê¸°ì¤‘',
            `"${attendee.checkedInAt || '-'}"`,
            attendee.dataType === 'REAL_DATA' ? 'ì‹¤ì œë°ì´í„°' : 
            attendee.dataType === 'SAMPLE_DATA' ? 'ìƒ˜í”Œë°ì´í„°' : 'ê¸°íƒ€',
            `"${attendee.timestamp ? new Date(attendee.timestamp).toLocaleString('ko-KR') : '-'}"`
          ].join(',');
        }).join('\n');

        const fullCsv = csvHeader + csvContent;
        
        // BOM ì¶”ê°€ (í•œê¸€ ê¹¨ì§ ë°©ì§€)
        const BOM = '\uFEFF';
        const blob = new Blob([BOM + fullCsv], { type: 'text/csv;charset=utf-8;' });
        
        // íŒŒì¼ ë‹¤ìš´ë¡œë“œ
        const link = document.createElement('a');
        const url = URL.createObjectURL(blob);
        link.setAttribute('href', url);
        
        const now = new Date();
        const dateStr = now.toISOString().split('T')[0];
        const timeStr = now.toTimeString().split(' ')[0].replace(/:/g, '');
        link.setAttribute('download', `ì˜¤ì‚°ê³ 71íšŒ_ì†¡ë…„íšŒ_ì°¸ì„ëª…ë‹¨_${dateStr}_${timeStr}.csv`);
        
        link.style.visibility = 'hidden';
        document.body.appendChild(link);
        link.click();
        document.body.removeChild(link);
        
        // ì„±ê³µ ë©”ì‹œì§€
        alert(`ğŸ“¤ ì°¸ì„ì ëª…ë‹¨ì´ ë‹¤ìš´ë¡œë“œë˜ì—ˆìŠµë‹ˆë‹¤!\n\nì´ ${attendees.length}ëª…ì˜ ë°ì´í„°ê°€ í¬í•¨ë˜ì—ˆìŠµë‹ˆë‹¤.`);
        
      } catch (error) {
        console.error('ëª…ë‹¨ ë‚´ë³´ë‚´ê¸° ì˜¤ë¥˜:', error);
        alert(`ë‚´ë³´ë‚´ê¸° ì‹¤íŒ¨: ${error.message}`);
      }
    }

    // í˜ì´ì§€ ì¢…ë£Œ ì‹œ Firebase ë¦¬ìŠ¤ë„ˆ ì •ë¦¬
    window.addEventListener('beforeunload', function() {
      if (firebaseUnsubscribe) {
        firebaseUnsubscribe();
        console.log('ğŸ”¥ Firebase ë¦¬ìŠ¤ë„ˆ í•´ì œë¨');
      }
    });
  </script>
</body>
</html>