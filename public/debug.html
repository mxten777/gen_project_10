<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ë°ì´í„° ìƒíƒœ í™•ì¸ - ì˜¤ì‚°ê³  71íšŒ ë™ê¸° ì†¡ë…„íšŒ</title>
  <script src="https://cdn.tailwindcss.com"></script>
  
  <!-- Firebase SDK & Config -->
  <script type="module">
    // Firebase ì„¤ì • íŒŒì¼ ë¡œë“œ
    import('./js/firebase-config.js')
      .then(() => {
        console.log('âœ… Firebase ì„¤ì • ë¡œë“œ ì™„ë£Œ');
        // Firebase Manager ì‚¬ìš© ê°€ëŠ¥ í™•ì¸
        setTimeout(() => {
          if (window.firebaseManager) {
            console.log('ğŸ”¥ Firebase Manager ì¤€ë¹„ë¨');
            window.dispatchEvent(new CustomEvent('firebaseReady', { 
              detail: { firebaseManager: window.firebaseManager } 
            }));
          }
        }, 1000);
      })
      .catch(error => {
        console.error('âŒ Firebase ì„¤ì • ë¡œë“œ ì‹¤íŒ¨:', error);
        document.getElementById('firebaseStatus').innerHTML = `âŒ <span class="text-red-400">ëª¨ë“ˆ ë¡œë“œ ì‹¤íŒ¨: ${error.message}</span>`;
      });
  </script>
  
  <style>
    body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", "Noto Sans KR", sans-serif; }
    
    .data-section {
      background: rgba(255, 255, 255, 0.1);
      backdrop-filter: blur(10px);
      border: 1px solid rgba(255, 255, 255, 0.2);
      border-radius: 12px;
      padding: 20px;
      margin-bottom: 20px;
    }
    
    .json-viewer {
      background: #1e293b;
      color: #e2e8f0;
      padding: 15px;
      border-radius: 8px;
      font-family: 'Courier New', monospace;
      font-size: 12px;
      white-space: pre-wrap;
      max-height: 300px;
      overflow-y: auto;
      border: 1px solid #334155;
    }
  </style>
</head>
<body class="bg-gradient-to-br from-blue-900 via-blue-700 to-slate-900 min-h-screen p-6">
  
  <div class="max-w-6xl mx-auto">
    <h1 class="text-3xl font-bold text-white mb-6 text-center">ğŸ“Š ë°ì´í„° ìƒíƒœ í™•ì¸</h1>
    
    <!-- Firebase ì—°ê²° ìƒíƒœ -->
    <div class="data-section">
      <h2 class="text-xl font-semibold text-white mb-4">ğŸ”¥ Firebase ì—°ê²° ìƒíƒœ</h2>
      <div id="firebaseStatus" class="text-yellow-300">ì—°ê²° í™•ì¸ ì¤‘...</div>
    </div>
    
    <!-- Firebase ë°ì´í„° -->
    <div class="data-section">
      <h2 class="text-xl font-semibold text-white mb-4">â˜ï¸ Firebase ë°ì´í„°</h2>
      <button onclick="loadFirebaseData()" class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded mb-3">
        Firebase ë°ì´í„° ìƒˆë¡œê³ ì¹¨
      </button>
      <div class="json-viewer" id="firebaseData">ë°ì´í„°ë¥¼ ë¡œë“œí•˜ë ¤ë©´ ìƒˆë¡œê³ ì¹¨ ë²„íŠ¼ì„ í´ë¦­í•˜ì„¸ìš”.</div>
    </div>
    
    <!-- localStorage ë°ì´í„° -->
    <div class="data-section">
      <h2 class="text-xl font-semibold text-white mb-4">ğŸ’¾ localStorage ë°ì´í„°</h2>
      <button onclick="loadLocalStorageData()" class="bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded mb-3">
        localStorage ìƒˆë¡œê³ ì¹¨
      </button>
      <div class="json-viewer" id="localStorageData">ë°ì´í„°ë¥¼ ë¡œë“œí•˜ë ¤ë©´ ìƒˆë¡œê³ ì¹¨ ë²„íŠ¼ì„ í´ë¦­í•˜ì„¸ìš”.</div>
    </div>
    
    <!-- ë°ì´í„° í†µê³„ -->
    <div class="data-section">
      <h2 class="text-xl font-semibold text-white mb-4">ğŸ“ˆ ë°ì´í„° í†µê³„</h2>
      
      <!-- ê¸°ë³¸ í†µê³„ -->
      <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-6" id="stats">
        <div class="bg-blue-800 bg-opacity-50 p-4 rounded-lg text-center">
          <div class="text-2xl font-bold text-blue-300" id="firebaseCount">-</div>
          <div class="text-blue-200">Firebase ì°¸ì„ì</div>
        </div>
        <div class="bg-green-800 bg-opacity-50 p-4 rounded-lg text-center">
          <div class="text-2xl font-bold text-green-300" id="localStorageCount">-</div>
          <div class="text-green-200">localStorage ì°¸ì„ì</div>
        </div>
        <div class="bg-purple-800 bg-opacity-50 p-4 rounded-lg text-center">
          <div class="text-2xl font-bold text-purple-300" id="checkedInCount">-</div>
          <div class="text-purple-200">ì²´í¬ì¸ ì™„ë£Œ</div>
        </div>
        <div class="bg-yellow-800 bg-opacity-50 p-4 rounded-lg text-center">
          <div class="text-2xl font-bold text-yellow-300" id="checkInRate">-</div>
          <div class="text-yellow-200">ì²´í¬ì¸ë¥ </div>
        </div>
      </div>
      
      <!-- ìƒì„¸ ë¶„ì„ -->
      <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
        <!-- Firebase ìƒì„¸ -->
        <div class="bg-slate-800 bg-opacity-50 p-4 rounded-lg">
          <h3 class="text-lg font-semibold text-white mb-3">ğŸ”¥ Firebase ìƒì„¸ ë¶„ì„</h3>
          <div class="space-y-2 text-sm">
            <div class="flex justify-between">
              <span class="text-slate-300">ì‹¤ì œ ë°ì´í„°:</span>
              <span class="text-green-400 font-semibold" id="firebaseRealCount">-</span>
            </div>
            <div class="flex justify-between">
              <span class="text-slate-300">ìƒ˜í”Œ ë°ì´í„°:</span>
              <span class="text-yellow-400 font-semibold" id="firebaseSampleCount">-</span>
            </div>
            <div class="flex justify-between">
              <span class="text-slate-300">ê¸°íƒ€ ë°ì´í„°:</span>
              <span class="text-blue-400 font-semibold" id="firebaseOtherCount">-</span>
            </div>
            <div class="border-t border-slate-600 pt-2 mt-2">
              <div class="flex justify-between">
                <span class="text-slate-300">ì²´í¬ì¸ ì™„ë£Œ:</span>
                <span class="text-purple-400 font-semibold" id="firebaseCheckedIn">-</span>
              </div>
              <div class="flex justify-between">
                <span class="text-slate-300">ëŒ€ê¸° ì¤‘:</span>
                <span class="text-orange-400 font-semibold" id="firebasePending">-</span>
              </div>
            </div>
          </div>
        </div>
        
        <!-- ì‹œê°„ëŒ€ë³„ ë¶„ì„ -->
        <div class="bg-slate-800 bg-opacity-50 p-4 rounded-lg">
          <h3 class="text-lg font-semibold text-white mb-3">â° ì‹œê°„ëŒ€ë³„ ë¶„ì„</h3>
          <div class="space-y-2 text-sm">
            <div class="flex justify-between">
              <span class="text-slate-300">ì˜¤ëŠ˜ ì²´í¬ì¸:</span>
              <span class="text-green-400 font-semibold" id="todayCheckins">-</span>
            </div>
            <div class="flex justify-between">
              <span class="text-slate-300">ìµœê·¼ 1ì‹œê°„:</span>
              <span class="text-blue-400 font-semibold" id="recentCheckins">-</span>
            </div>
            <div class="flex justify-between">
              <span class="text-slate-300">í‰ê·  ê°„ê²©:</span>
              <span class="text-yellow-400 font-semibold" id="avgInterval">-</span>
            </div>
            <div class="border-t border-slate-600 pt-2 mt-2">
              <div class="flex justify-between">
                <span class="text-slate-300">ì²« ì²´í¬ì¸:</span>
                <span class="text-purple-400 font-semibold" id="firstCheckin">-</span>
              </div>
              <div class="flex justify-between">
                <span class="text-slate-300">ìµœê·¼ ì²´í¬ì¸:</span>
                <span class="text-orange-400 font-semibold" id="lastCheckin">-</span>
              </div>
            </div>
          </div>
        </div>
      </div>
      
      <!-- ì‹¤ì‹œê°„ ì—…ë°ì´íŠ¸ -->
      <div class="mt-4 flex justify-between items-center">
        <span class="text-slate-400 text-sm">ë§ˆì§€ë§‰ ì—…ë°ì´íŠ¸: <span id="lastUpdate">-</span></span>
        <button onclick="updateDetailedStats()" class="bg-indigo-600 hover:bg-indigo-700 text-white px-3 py-1 rounded text-sm">
          ğŸ”„ í†µê³„ ìƒˆë¡œê³ ì¹¨
        </button>
      </div>
    </div>
    
    <!-- ì•¡ì…˜ ë²„íŠ¼ë“¤ -->
    <div class="data-section">
      <h2 class="text-xl font-semibold text-white mb-4">ğŸ› ï¸ ê´€ë¦¬ ë„êµ¬</h2>
      
      <!-- ë°ì´í„° ì¶”ê°€/ìƒì„± -->
      <div class="mb-4">
        <h3 class="text-lg text-white mb-2">ğŸ“ ë°ì´í„° ìƒì„±</h3>
        <div class="grid grid-cols-1 md:grid-cols-2 gap-3">
          <button onclick="addSampleData()" class="bg-yellow-600 hover:bg-yellow-700 text-white px-4 py-3 rounded font-semibold">
            ğŸ§ª ìƒ˜í”Œ ë°ì´í„° ì¶”ê°€ (5ëª…)
          </button>
          <button onclick="addRealData()" class="bg-green-600 hover:bg-green-700 text-white px-4 py-3 rounded font-semibold">
            ğŸ‘¥ ì‹¤ì œ ë°ì´í„° ì¶”ê°€ (10ëª…)
          </button>
        </div>
      </div>
      
      <!-- ë°ì´í„° ì‚­ì œ/ì´ˆê¸°í™” -->
      <div class="mb-4">
        <h3 class="text-lg text-white mb-2">ğŸ—‘ï¸ ë°ì´í„° ì‚­ì œ</h3>
        <div class="grid grid-cols-1 md:grid-cols-3 gap-3">
          <button onclick="clearLocalStorage()" class="bg-orange-600 hover:bg-orange-700 text-white px-4 py-3 rounded font-semibold">
            ğŸ’¾ localStorage ì´ˆê¸°í™”
          </button>
          <button onclick="clearFirebaseData()" class="bg-red-600 hover:bg-red-700 text-white px-4 py-3 rounded font-semibold">
            ğŸ”¥ Firebase ì „ì²´ ì´ˆê¸°í™”
          </button>
          <button onclick="clearAllData()" class="bg-gray-800 hover:bg-gray-900 text-white px-4 py-3 rounded font-semibold border-2 border-red-500">
            âš ï¸ ëª¨ë“  ë°ì´í„° ì‚­ì œ
          </button>
        </div>
      </div>
      
      <!-- ìœ í‹¸ë¦¬í‹° -->
      <div>
        <h3 class="text-lg text-white mb-2">ğŸ”§ ìœ í‹¸ë¦¬í‹°</h3>
        <div class="grid grid-cols-1 md:grid-cols-3 gap-3">
          <button onclick="analyzeData()" class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-3 rounded font-semibold">
            ğŸ“Š ë°ì´í„° ë¶„ì„
          </button>
          <button onclick="exportAllData()" class="bg-indigo-600 hover:bg-indigo-700 text-white px-4 py-3 rounded font-semibold">
            ğŸ“¤ ë°ì´í„° ë°±ì—…
          </button>
          <a href="admin.html" class="bg-purple-600 hover:bg-purple-700 text-white px-4 py-3 rounded font-semibold text-center">
            âš™ï¸ ê´€ë¦¬ì í˜ì´ì§€
          </a>
        </div>
      </div>
    </div>
    
    <!-- ê²½ê³  ë©”ì‹œì§€ -->
    <div class="data-section bg-red-900 bg-opacity-30 border-red-500">
      <h2 class="text-xl font-semibold text-red-300 mb-4">âš ï¸ ì¤‘ìš” ê²½ê³ </h2>
      <div class="text-red-200 space-y-2 text-sm">
        <p>â€¢ <strong>Firebase ì „ì²´ ì´ˆê¸°í™”</strong>: ëª¨ë“  ì°¸ì„ì ë°ì´í„°ê°€ ì˜êµ¬ì ìœ¼ë¡œ ì‚­ì œë©ë‹ˆë‹¤</p>
        <p>â€¢ <strong>ì‹¤ì œ ë°ì´í„°</strong>: í…ŒìŠ¤íŠ¸ê°€ ì•„ë‹Œ ì‹¤ì œ í–‰ì‚¬ìš© ë°ì´í„°ì…ë‹ˆë‹¤</p>
        <p>â€¢ <strong>ìƒ˜í”Œ ë°ì´í„°</strong>: í…ŒìŠ¤íŠ¸ ëª©ì ìœ¼ë¡œë§Œ ì‚¬ìš©í•˜ì„¸ìš”</p>
        <p>â€¢ ì‚­ì œëœ ë°ì´í„°ëŠ” ë³µêµ¬í•  ìˆ˜ ì—†ìœ¼ë‹ˆ ì‹ ì¤‘í•˜ê²Œ ì‚¬ìš©í•˜ì„¸ìš”</p>
      </div>
    </div>
  </div>

  <script>
    let firebaseManager = null;

    // Firebase ì—°ê²° í™•ì¸
    async function checkFirebaseConnection() {
      try {
        document.getElementById('firebaseStatus').innerHTML = 'ğŸ”„ <span class="text-yellow-400">Firebase ì—°ê²° í™•ì¸ ì¤‘...</span>';
        
        // Firebase Manager ë¡œë“œ ëŒ€ê¸°
        let retryCount = 0;
        while (!window.firebaseManager && retryCount < 20) {
          console.log(`Firebase Manager ëŒ€ê¸° ì¤‘... (${retryCount + 1}/20)`);
          await new Promise(resolve => setTimeout(resolve, 500));
          retryCount++;
        }

        if (window.firebaseManager) {
          firebaseManager = window.firebaseManager;
          
          // ì—°ê²° í…ŒìŠ¤íŠ¸ ìˆ˜í–‰
          const connectionOk = await firebaseManager.testConnection();
          
          if (connectionOk && firebaseManager.connectionTested) {
            document.getElementById('firebaseStatus').innerHTML = 'âœ… <span class="text-green-400">Firebase ì—°ê²° ì„±ê³µ</span>';
            return true;
          } else {
            document.getElementById('firebaseStatus').innerHTML = 'âš ï¸ <span class="text-yellow-400">Firebase ì—°ê²° ë¶ˆì•ˆì •</span>';
            return false;
          }
        } else {
          console.error('Firebase Manager ë¡œë“œ ì‹¤íŒ¨');
          document.getElementById('firebaseStatus').innerHTML = 'âŒ <span class="text-red-400">Firebase Manager ë¡œë“œ ì‹¤íŒ¨</span>';
          return false;
        }
      } catch (error) {
        console.error('Firebase ì—°ê²° í™•ì¸ ì˜¤ë¥˜:', error);
        document.getElementById('firebaseStatus').innerHTML = `âŒ <span class="text-red-400">Firebase ì˜¤ë¥˜: ${error.message}</span>`;
        
        // ìƒì„¸í•œ ì˜¤ë¥˜ ì •ë³´ í‘œì‹œ
        if (error.code) {
          const errorDetails = document.createElement('div');
          errorDetails.className = 'text-red-300 text-sm mt-2';
          errorDetails.innerHTML = `
            ì˜¤ë¥˜ ì½”ë“œ: ${error.code}<br>
            ${getErrorMessage(error.code)}
          `;
          document.getElementById('firebaseStatus').appendChild(errorDetails);
        }
        
        return false;
      }
    }
    
    // ì˜¤ë¥˜ ì½”ë“œë³„ í•´ê²° ë°©ë²• ì œì‹œ
    function getErrorMessage(errorCode) {
      const errorMessages = {
        'permission-denied': 'ğŸ” Firestore ë³´ì•ˆ ê·œì¹™ì„ í…ŒìŠ¤íŠ¸ ëª¨ë“œë¡œ ë³€ê²½í•˜ì„¸ìš”',
        'unavailable': 'ğŸŒ ì¸í„°ë„· ì—°ê²°ì„ í™•ì¸í•˜ê³  Firebase ì„œë¹„ìŠ¤ ìƒíƒœë¥¼ ì ê²€í•˜ì„¸ìš”',
        'unauthenticated': 'ğŸ”‘ Firebase í”„ë¡œì íŠ¸ ì„¤ì • ë° API í‚¤ë¥¼ í™•ì¸í•˜ì„¸ìš”',
        'not-found': 'ğŸ“ Firestore ë°ì´í„°ë² ì´ìŠ¤ê°€ ìƒì„±ë˜ì—ˆëŠ”ì§€ í™•ì¸í•˜ì„¸ìš”',
        'failed-precondition': 'âš™ï¸ Firestore ë°ì´í„°ë² ì´ìŠ¤ê°€ ì˜¬ë°”ë¥´ê²Œ ì„¤ì •ë˜ì—ˆëŠ”ì§€ í™•ì¸í•˜ì„¸ìš”'
      };
      
      return errorMessages[errorCode] || 'â“ Firebase Consoleì—ì„œ í”„ë¡œì íŠ¸ ìƒíƒœë¥¼ í™•ì¸í•˜ì„¸ìš”';
    }

    // Firebase ë°ì´í„° ë¡œë“œ
    async function loadFirebaseData() {
      const container = document.getElementById('firebaseData');
      container.textContent = 'ë°ì´í„° ë¡œë”© ì¤‘...';
      
      try {
        if (!firebaseManager) {
          const connected = await checkFirebaseConnection();
          if (!connected) {
            container.textContent = 'Firebase ì—°ê²°ì´ í•„ìš”í•©ë‹ˆë‹¤.';
            return;
          }
        }

        const attendees = await firebaseManager.getAttendees();
        
        if (attendees.length === 0) {
          container.textContent = 'ğŸ“­ Firebaseì— ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.\n\nì²´í¬ì¸ì„ í•´ë³´ê±°ë‚˜ "ìƒ˜í”Œ ë°ì´í„° ì¶”ê°€" ë²„íŠ¼ì„ ëˆŒëŸ¬ì£¼ì„¸ìš”.';
        } else {
          container.textContent = JSON.stringify(attendees, null, 2);
        }
        
        // ê¸°ë³¸ í†µê³„ ì—…ë°ì´íŠ¸
        document.getElementById('firebaseCount').textContent = attendees.length;
        document.getElementById('checkedInCount').textContent = attendees.filter(a => a.checkedIn).length;
        
        // ìƒì„¸ í†µê³„ ì—…ë°ì´íŠ¸
        updateDetailedStats(attendees);
        
      } catch (error) {
        console.error('Firebase ë°ì´í„° ë¡œë“œ ì˜¤ë¥˜:', error);
        container.textContent = `ì˜¤ë¥˜ ë°œìƒ: ${error.message}`;
      }
    }

    // localStorage ë°ì´í„° ë¡œë“œ
    function loadLocalStorageData() {
      const container = document.getElementById('localStorageData');
      
      try {
        const attendeesData = localStorage.getItem('attendees');
        const cacheVersion = localStorage.getItem('cacheVersion');
        const migrated = localStorage.getItem('firebase_migrated');
        
        const allData = {
          attendees: attendeesData ? JSON.parse(attendeesData) : [],
          cacheVersion: cacheVersion,
          firebase_migrated: migrated,
          storage_size: new Blob([attendeesData || '[]']).size
        };
        
        if (allData.attendees.length === 0) {
          container.textContent = 'ğŸ“­ localStorageì— ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.\n\n' + JSON.stringify(allData, null, 2);
        } else {
          container.textContent = JSON.stringify(allData, null, 2);
        }
        
        document.getElementById('localStorageCount').textContent = allData.attendees.length;
        
        // localStorage ê¸°ë°˜ í†µê³„ ì—…ë°ì´íŠ¸
        updateLocalStorageStats(allData.attendees);
        
      } catch (error) {
        console.error('localStorage ë°ì´í„° ë¡œë“œ ì˜¤ë¥˜:', error);
        container.textContent = `ì˜¤ë¥˜ ë°œìƒ: ${error.message}`;
      }
    }

    // ìƒ˜í”Œ ë°ì´í„° ì¶”ê°€ (í…ŒìŠ¤íŠ¸ìš©)
    async function addSampleData() {
      if (!confirm('í…ŒìŠ¤íŠ¸ìš© ìƒ˜í”Œ ë°ì´í„° 5ëª…ì„ ì¶”ê°€í•˜ì‹œê² ìŠµë‹ˆê¹Œ?\n\nğŸ§ª ì´ëŠ” í…ŒìŠ¤íŠ¸ ëª©ì ì˜ ê°€ì§œ ë°ì´í„°ì…ë‹ˆë‹¤.')) return;
      
      const sampleAttendees = [
        { name: 'ê¹€í…ŒìŠ¤íŠ¸', phone: '010-1111-1111', checkedIn: true, isReal: false },
        { name: 'ì´ìƒ˜í”Œ', phone: '010-2222-2222', checkedIn: false, isReal: false },
        { name: 'ë°•ë°ëª¨', phone: '010-3333-3333', checkedIn: true, isReal: false },
        { name: 'ì •ì˜ˆì‹œ', phone: '010-4444-4444', checkedIn: false, isReal: false },
        { name: 'ìµœë”ë¯¸', phone: '010-5555-5555', checkedIn: true, isReal: false }
      ];

      try {
        if (firebaseManager) {
          for (const attendee of sampleAttendees) {
            await firebaseManager.addAttendee({
              ...attendee,
              checkedInAt: attendee.checkedIn ? new Date().toLocaleString('ko-KR') : '',
              dataType: 'SAMPLE_DATA',
              addedAt: new Date().toLocaleString('ko-KR')
            });
          }
          alert('í…ŒìŠ¤íŠ¸ìš© ìƒ˜í”Œ ë°ì´í„° 5ëª…ì´ Firebaseì— ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤!');
        } else {
          let existingData = JSON.parse(localStorage.getItem('attendees') || '[]');
          sampleAttendees.forEach(attendee => {
            existingData.push({
              id: Date.now().toString() + Math.random(),
              ...attendee,
              checkedInAt: attendee.checkedIn ? new Date().toLocaleString('ko-KR') : '',
              dataType: 'SAMPLE_DATA'
            });
          });
          localStorage.setItem('attendees', JSON.stringify(existingData));
          alert('localStorageì— ìƒ˜í”Œ ë°ì´í„°ê°€ ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤!');
        }
        
        loadFirebaseData();
        loadLocalStorageData();
        
      } catch (error) {
        console.error('ìƒ˜í”Œ ë°ì´í„° ì¶”ê°€ ì˜¤ë¥˜:', error);
        alert(`ì˜¤ë¥˜ ë°œìƒ: ${error.message}`);
      }
    }

    // ë°ì´í„° ë¶„ì„
    async function analyzeData() {
      try {
        let analysis = {
          firebase: { total: 0, checkedIn: 0, sample: 0, real: 0 },
          localStorage: { total: 0, checkedIn: 0 }
        };

        // Firebase ë¶„ì„
        if (firebaseManager) {
          const firebaseData = await firebaseManager.getAttendees();
          analysis.firebase.total = firebaseData.length;
          analysis.firebase.checkedIn = firebaseData.filter(a => a.checkedIn).length;
          analysis.firebase.sample = firebaseData.filter(a => a.dataType === 'SAMPLE_DATA').length;
          analysis.firebase.real = firebaseData.filter(a => a.dataType === 'REAL_DATA').length;
        }

        // localStorage ë¶„ì„
        const localData = JSON.parse(localStorage.getItem('attendees') || '[]');
        analysis.localStorage.total = localData.length;
        analysis.localStorage.checkedIn = localData.filter(a => a.checkedIn).length;

        const analysisText = `
ğŸ“Š ë°ì´í„° ë¶„ì„ ê²°ê³¼

ğŸ”¥ Firebase:
â€¢ ì „ì²´: ${analysis.firebase.total}ëª…
â€¢ ì²´í¬ì¸ ì™„ë£Œ: ${analysis.firebase.checkedIn}ëª…
â€¢ ìƒ˜í”Œ ë°ì´í„°: ${analysis.firebase.sample}ëª…
â€¢ ì‹¤ì œ ë°ì´í„°: ${analysis.firebase.real}ëª…
â€¢ ê¸°íƒ€ ë°ì´í„°: ${analysis.firebase.total - analysis.firebase.sample - analysis.firebase.real}ëª…

ğŸ’¾ localStorage:
â€¢ ì „ì²´: ${analysis.localStorage.total}ëª…
â€¢ ì²´í¬ì¸ ì™„ë£Œ: ${analysis.localStorage.checkedIn}ëª…

ğŸ“ˆ í†µê³„:
â€¢ Firebase ì²´í¬ì¸ë¥ : ${analysis.firebase.total > 0 ? Math.round((analysis.firebase.checkedIn / analysis.firebase.total) * 100) : 0}%
â€¢ localStorage ì²´í¬ì¸ë¥ : ${analysis.localStorage.total > 0 ? Math.round((analysis.localStorage.checkedIn / analysis.localStorage.total) * 100) : 0}%
        `;

        alert(analysisText);
        console.log('ë°ì´í„° ë¶„ì„:', analysis);

      } catch (error) {
        console.error('ë°ì´í„° ë¶„ì„ ì˜¤ë¥˜:', error);
        alert(`ë¶„ì„ ì¤‘ ì˜¤ë¥˜ ë°œìƒ: ${error.message}`);
      }
    }

    // ì „ì²´ ë°ì´í„° ë°±ì—…
    async function exportAllData() {
      try {
        const backupData = {
          timestamp: new Date().toLocaleString('ko-KR'),
          firebase: null,
          localStorage: null
        };

        // Firebase ë°ì´í„°
        if (firebaseManager) {
          backupData.firebase = await firebaseManager.getAttendees();
        }

        // localStorage ë°ì´í„°
        backupData.localStorage = JSON.parse(localStorage.getItem('attendees') || '[]');

        const dataStr = JSON.stringify(backupData, null, 2);
        const dataBlob = new Blob([dataStr], { type: 'application/json' });
        
        const link = document.createElement('a');
        link.href = URL.createObjectURL(dataBlob);
        link.download = `ì˜¤ì‚°ê³ _71íšŒ_ì†¡ë…„íšŒ_ë°±ì—…_${new Date().toISOString().split('T')[0]}.json`;
        link.click();

        alert(`ë°ì´í„°ê°€ ë°±ì—…ë˜ì—ˆìŠµë‹ˆë‹¤!\n\nì´ ${(backupData.firebase?.length || 0) + (backupData.localStorage?.length || 0)}ê°œ ë°ì´í„°ê°€ í¬í•¨ë˜ì—ˆìŠµë‹ˆë‹¤.`);

      } catch (error) {
        console.error('ë°ì´í„° ë°±ì—… ì˜¤ë¥˜:', error);
        alert(`ë°±ì—… ì¤‘ ì˜¤ë¥˜ ë°œìƒ: ${error.message}`);
      }
    }

    // ìƒì„¸ í†µê³„ ì—…ë°ì´íŠ¸
    async function updateDetailedStats(attendees = null) {
      try {
        // Firebase ë°ì´í„°ê°€ ì—†ìœ¼ë©´ ìƒˆë¡œ ë¡œë“œ
        if (!attendees && firebaseManager) {
          attendees = await firebaseManager.getAttendees();
        }
        
        if (attendees && attendees.length > 0) {
          // ë°ì´í„° íƒ€ì…ë³„ ë¶„ë¥˜
          const realData = attendees.filter(a => a.dataType === 'REAL_DATA');
          const sampleData = attendees.filter(a => a.dataType === 'SAMPLE_DATA');
          const otherData = attendees.filter(a => !a.dataType || (a.dataType !== 'REAL_DATA' && a.dataType !== 'SAMPLE_DATA'));
          
          // ì²´í¬ì¸ ìƒíƒœë³„ ë¶„ë¥˜
          const checkedIn = attendees.filter(a => a.checkedIn);
          const pending = attendees.filter(a => !a.checkedIn);
          
          // Firebase ìƒì„¸ í†µê³„ ì—…ë°ì´íŠ¸
          document.getElementById('firebaseRealCount').textContent = `${realData.length}ëª…`;
          document.getElementById('firebaseSampleCount').textContent = `${sampleData.length}ëª…`;
          document.getElementById('firebaseOtherCount').textContent = `${otherData.length}ëª…`;
          document.getElementById('firebaseCheckedIn').textContent = `${checkedIn.length}ëª…`;
          document.getElementById('firebasePending').textContent = `${pending.length}ëª…`;
          
          // ì²´í¬ì¸ë¥  ê³„ì‚°
          const checkInRate = attendees.length > 0 ? Math.round((checkedIn.length / attendees.length) * 100) : 0;
          document.getElementById('checkInRate').textContent = `${checkInRate}%`;
          
          // ì‹œê°„ëŒ€ë³„ ë¶„ì„
          updateTimeAnalysis(attendees);
          
        } else {
          // ë°ì´í„°ê°€ ì—†ì„ ë•Œ ì´ˆê¸°í™”
          resetStatsDisplay();
        }
        
        // ë§ˆì§€ë§‰ ì—…ë°ì´íŠ¸ ì‹œê°„
        document.getElementById('lastUpdate').textContent = new Date().toLocaleTimeString('ko-KR');
        
      } catch (error) {
        console.error('ìƒì„¸ í†µê³„ ì—…ë°ì´íŠ¸ ì˜¤ë¥˜:', error);
      }
    }

    // ì‹œê°„ëŒ€ë³„ ë¶„ì„
    function updateTimeAnalysis(attendees) {
      const now = new Date();
      const today = now.toDateString();
      const oneHourAgo = new Date(now.getTime() - 60 * 60 * 1000);
      
      // ì˜¤ëŠ˜ ì²´í¬ì¸
      const todayCheckins = attendees.filter(a => {
        if (!a.checkedInAt) return false;
        const checkinDate = new Date(a.checkedInAt).toDateString();
        return checkinDate === today && a.checkedIn;
      });
      
      // ìµœê·¼ 1ì‹œê°„ ì²´í¬ì¸
      const recentCheckins = attendees.filter(a => {
        if (!a.checkedInAt) return false;
        const checkinTime = new Date(a.checkedInAt);
        return checkinTime >= oneHourAgo && a.checkedIn;
      });
      
      // ì²´í¬ì¸ ì‹œê°„ë“¤ ìˆ˜ì§‘
      const checkinTimes = attendees
        .filter(a => a.checkedIn && a.checkedInAt)
        .map(a => new Date(a.checkedInAt))
        .sort((a, b) => a - b);
      
      // ì²« ë²ˆì§¸ì™€ ë§ˆì§€ë§‰ ì²´í¬ì¸
      const firstCheckin = checkinTimes.length > 0 ? checkinTimes[0] : null;
      const lastCheckin = checkinTimes.length > 0 ? checkinTimes[checkinTimes.length - 1] : null;
      
      // í‰ê·  ì²´í¬ì¸ ê°„ê²© ê³„ì‚°
      let avgInterval = '-';
      if (checkinTimes.length > 1) {
        const totalTime = lastCheckin - firstCheckin;
        const avgMs = totalTime / (checkinTimes.length - 1);
        const avgMinutes = Math.round(avgMs / (1000 * 60));
        avgInterval = `${avgMinutes}ë¶„`;
      }
      
      // UI ì—…ë°ì´íŠ¸
      document.getElementById('todayCheckins').textContent = `${todayCheckins.length}ëª…`;
      document.getElementById('recentCheckins').textContent = `${recentCheckins.length}ëª…`;
      document.getElementById('avgInterval').textContent = avgInterval;
      document.getElementById('firstCheckin').textContent = firstCheckin ? firstCheckin.toLocaleTimeString('ko-KR') : '-';
      document.getElementById('lastCheckin').textContent = lastCheckin ? lastCheckin.toLocaleTimeString('ko-KR') : '-';
    }

    // localStorage í†µê³„ ì—…ë°ì´íŠ¸
    function updateLocalStorageStats(attendees) {
      // localStorage ë°ì´í„°ë„ Firebaseì™€ ë™ì¼í•œ ë°©ì‹ìœ¼ë¡œ ë¶„ì„ ê°€ëŠ¥
      // í˜„ì¬ëŠ” ê¸°ë³¸ ì¹´ìš´íŠ¸ë§Œ í‘œì‹œí•˜ì§€ë§Œ í•„ìš”ì‹œ í™•ì¥ ê°€ëŠ¥
    }

    // í†µê³„ í‘œì‹œ ì´ˆê¸°í™”
    function resetStatsDisplay() {
      const statElements = [
        'firebaseRealCount', 'firebaseSampleCount', 'firebaseOtherCount',
        'firebaseCheckedIn', 'firebasePending', 'checkInRate',
        'todayCheckins', 'recentCheckins', 'avgInterval', 
        'firstCheckin', 'lastCheckin'
      ];
      
      statElements.forEach(id => {
        const element = document.getElementById(id);
        if (element) element.textContent = '-';
      });
    }

    // ì‹¤ì œ ë°ì´í„° ì¶”ê°€ (ì˜¤ì‚°ê³  ë™ê¸°ë“¤ ì´ë¦„)
    async function addRealData() {
      if (!confirm('ì‹¤ì œ í–‰ì‚¬ìš© ë°ì´í„° 10ëª…ì„ ì¶”ê°€í•˜ì‹œê² ìŠµë‹ˆê¹Œ?\n\nâš ï¸ ì´ëŠ” í…ŒìŠ¤íŠ¸ ë°ì´í„°ê°€ ì•„ë‹Œ ì‹¤ì œ ë°ì´í„°ì…ë‹ˆë‹¤.')) return;
      
      const realAttendees = [
        { name: 'ê¹€ì˜ìˆ˜', phone: '010-1234-5678', checkedIn: false, isReal: true },
        { name: 'ì´ë¯¼í˜¸', phone: '010-2345-6789', checkedIn: false, isReal: true },
        { name: 'ë°•ì§€ì›', phone: '010-3456-7890', checkedIn: true, isReal: true },
        { name: 'ì •ìˆ˜í˜„', phone: '010-4567-8901', checkedIn: false, isReal: true },
        { name: 'ìµœë™ìš±', phone: '010-5678-9012', checkedIn: true, isReal: true },
        { name: 'ê°•ë¯¼ì •', phone: '010-6789-0123', checkedIn: false, isReal: true },
        { name: 'ìœ¤ì„œì˜', phone: '010-7890-1234', checkedIn: true, isReal: true },
        { name: 'ì„ì¬í˜„', phone: '010-8901-2345', checkedIn: false, isReal: true },
        { name: 'í•œì§€ìˆ˜', phone: '010-9012-3456', checkedIn: false, isReal: true },
        { name: 'ì¡°ë¯¼ìˆ˜', phone: '010-0123-4567', checkedIn: true, isReal: true }
      ];

      try {
        if (firebaseManager) {
          for (const attendee of realAttendees) {
            await firebaseManager.addAttendee({
              ...attendee,
              checkedInAt: attendee.checkedIn ? new Date().toLocaleString('ko-KR') : '',
              dataType: 'REAL_DATA',
              addedAt: new Date().toLocaleString('ko-KR')
            });
          }
          alert('ì‹¤ì œ ë°ì´í„° 10ëª…ì´ Firebaseì— ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤!');
        } else {
          alert('Firebaseê°€ ì—°ê²°ë˜ì§€ ì•Šì•„ ì‹¤ì œ ë°ì´í„°ë¥¼ ì¶”ê°€í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
        }
        
        loadFirebaseData();
        loadLocalStorageData();
        
      } catch (error) {
        console.error('ì‹¤ì œ ë°ì´í„° ì¶”ê°€ ì˜¤ë¥˜:', error);
        alert(`ì˜¤ë¥˜ ë°œìƒ: ${error.message}`);
      }
    }

    // Firebase ì „ì²´ ë°ì´í„° ì‚­ì œ
    async function clearFirebaseData() {
      if (!firebaseManager) {
        alert('Firebaseê°€ ì—°ê²°ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.');
        return;
      }

      const confirmMessage = `âš ï¸ ë§¤ìš° ìœ„í—˜í•œ ì‘ì—…ì…ë‹ˆë‹¤! âš ï¸

Firebaseì˜ ëª¨ë“  ì°¸ì„ì ë°ì´í„°ê°€ ì˜êµ¬ì ìœ¼ë¡œ ì‚­ì œë©ë‹ˆë‹¤.
ì´ ì‘ì—…ì€ ë˜ëŒë¦´ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.

ì •ë§ë¡œ ëª¨ë“  Firebase ë°ì´í„°ë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?

ì‚­ì œí•˜ë ¤ë©´ "DELETE"ë¼ê³  ì •í™•íˆ ì…ë ¥í•˜ì„¸ìš”:`;

      const userInput = prompt(confirmMessage);
      
      if (userInput !== 'DELETE') {
        alert('ì·¨ì†Œë˜ì—ˆìŠµë‹ˆë‹¤. ì•ˆì „ì„ ìœ„í•´ ì •í™•í•œ í…ìŠ¤íŠ¸ë¥¼ ì…ë ¥í•´ì•¼ í•©ë‹ˆë‹¤.');
        return;
      }

      try {
        document.getElementById('firebaseStatus').innerHTML = 'ğŸ”„ <span class="text-red-400">Firebase ë°ì´í„° ì‚­ì œ ì¤‘...</span>';
        
        const attendees = await firebaseManager.getAttendees();
        let deleteCount = 0;
        
        for (const attendee of attendees) {
          await firebaseManager.deleteAttendee(attendee.id);
          deleteCount++;
        }
        
        alert(`Firebaseì—ì„œ ${deleteCount}ê°œì˜ ë°ì´í„°ê°€ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.`);
        loadFirebaseData();
        
      } catch (error) {
        console.error('Firebase ë°ì´í„° ì‚­ì œ ì˜¤ë¥˜:', error);
        alert(`ì‚­ì œ ì¤‘ ì˜¤ë¥˜ ë°œìƒ: ${error.message}`);
      }
    }

    // ëª¨ë“  ë°ì´í„° ì‚­ì œ (localStorage + Firebase)
    async function clearAllData() {
      const confirmMessage = `ğŸš¨ ëª¨ë“  ë°ì´í„° ì™„ì „ ì‚­ì œ ğŸš¨

ë‹¤ìŒ ë°ì´í„°ê°€ ëª¨ë‘ ì‚­ì œë©ë‹ˆë‹¤:
â€¢ Firebaseì˜ ëª¨ë“  ì°¸ì„ì ë°ì´í„°
â€¢ localStorageì˜ ëª¨ë“  ë¡œì»¬ ë°ì´í„°
â€¢ ìºì‹œ ë° ì„¤ì • ì •ë³´

ì´ ì‘ì—…ì€ ì ˆëŒ€ ë˜ëŒë¦´ ìˆ˜ ì—†ìŠµë‹ˆë‹¤!

ì •ë§ë¡œ ëª¨ë“  ë°ì´í„°ë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?
ì‚­ì œí•˜ë ¤ë©´ "CLEAR ALL"ì´ë¼ê³  ì •í™•íˆ ì…ë ¥í•˜ì„¸ìš”:`;

      const userInput = prompt(confirmMessage);
      
      if (userInput !== 'CLEAR ALL') {
        alert('ì·¨ì†Œë˜ì—ˆìŠµë‹ˆë‹¤. ì•ˆì „ì„ ìœ„í•´ ì •í™•í•œ í…ìŠ¤íŠ¸ë¥¼ ì…ë ¥í•´ì•¼ í•©ë‹ˆë‹¤.');
        return;
      }

      try {
        // Firebase ë°ì´í„° ì‚­ì œ
        if (firebaseManager) {
          const attendees = await firebaseManager.getAttendees();
          for (const attendee of attendees) {
            await firebaseManager.deleteAttendee(attendee.id);
          }
        }

        // localStorage ì´ˆê¸°í™”
        localStorage.clear();
        
        alert('ëª¨ë“  ë°ì´í„°ê°€ ì™„ì „íˆ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.');
        
        // UI ìƒˆë¡œê³ ì¹¨
        loadFirebaseData();
        loadLocalStorageData();
        
      } catch (error) {
        console.error('ì „ì²´ ë°ì´í„° ì‚­ì œ ì˜¤ë¥˜:', error);
        alert(`ì‚­ì œ ì¤‘ ì˜¤ë¥˜ ë°œìƒ: ${error.message}`);
      }
    }

    // localStorage ì´ˆê¸°í™” (ê¸°ì¡´ í•¨ìˆ˜ ê°œì„ )
    function clearLocalStorage() {
      const localData = localStorage.getItem('attendees');
      const dataCount = localData ? JSON.parse(localData).length : 0;
      
      if (!confirm(`localStorage ë°ì´í„° ${dataCount}ê°œë¥¼ ëª¨ë‘ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?\n\nâš ï¸ ì´ ì‘ì—…ì€ ë˜ëŒë¦´ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.`)) return;
      
      localStorage.removeItem('attendees');
      localStorage.removeItem('cacheVersion');
      localStorage.removeItem('firebase_migrated');
      
      alert(`localStorageì—ì„œ ${dataCount}ê°œ ë°ì´í„°ê°€ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.`);
      loadLocalStorageData();
    }

    // Firebase ì¤€ë¹„ ì™„ë£Œ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ
    window.addEventListener('firebaseReady', function(event) {
      console.log('ğŸ‰ Firebase ì¤€ë¹„ ì™„ë£Œ ì´ë²¤íŠ¸ ìˆ˜ì‹ ');
      firebaseManager = event.detail.firebaseManager;
      checkFirebaseConnection();
    });

    // í˜ì´ì§€ ë¡œë“œ ì‹œ ì‹¤í–‰
    window.addEventListener('load', async function() {
      console.log('ğŸ“„ í˜ì´ì§€ ë¡œë“œ ì™„ë£Œ');
      
      // localStorage ë°ì´í„°ëŠ” ì¦‰ì‹œ ë¡œë“œ
      loadLocalStorageData();
      
      // FirebaseëŠ” ì¤€ë¹„ë  ë•Œê¹Œì§€ ëŒ€ê¸°
      if (window.firebaseManager) {
        console.log('ğŸ”¥ Firebase Manager ì´ë¯¸ ì¤€ë¹„ë¨');
        await checkFirebaseConnection();
        if (firebaseManager) {
          loadFirebaseData();
        }
      } else {
        console.log('â³ Firebase Manager ì¤€ë¹„ ëŒ€ê¸° ì¤‘...');
        // firebaseReady ì´ë²¤íŠ¸ë¥¼ ê¸°ë‹¤ë¦¬ê±°ë‚˜ ì¬ì‹œë„
        setTimeout(async () => {
          if (window.firebaseManager) {
            await checkFirebaseConnection();
            if (firebaseManager) {
              loadFirebaseData();
            }
          }
        }, 2000);
      }
    });
  </script>
</body>
</html>