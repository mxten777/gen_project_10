<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <meta name="version" content="v2.2.0">
    <title>ì˜¤ì‚°ê³ ë“±í•™êµ 71íšŒ ë™ê¸° ì†¡ë…„íšŒ ì´ˆëŒ€ì¥</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>ğŸ‰</text></svg>">
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            font-family: 'Malgun Gothic', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        .invitation-card {
            background: linear-gradient(145deg, #4c63d2, #5a67d8);
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.4);
        }
        .event-detail {
            background: linear-gradient(145deg, #2d3748, #4a5568);
        }
        .program-item {
            transition: all 0.3s ease;
        }
        .program-item:hover {
            transform: translateX(5px);
            background-color: rgba(255, 255, 255, 0.1);
        }
    </style>
</head>
<body class="min-h-screen p-4">
    <!-- ë„¤ë¹„ê²Œì´ì…˜ -->
    <nav class="fixed top-0 left-0 right-0 bg-black bg-opacity-50 backdrop-blur-sm z-40 p-3">
        <div class="flex justify-between items-center max-w-md mx-auto">
            <div class="flex items-center gap-2">
                <div class="w-8 h-8 bg-gradient-to-br from-blue-500 to-purple-600 rounded-full flex items-center justify-center">
                    <span class="text-white text-sm font-bold">71</span>
                </div>
                <span class="text-white font-bold text-sm">ì˜¤ì‚°ê³  71íšŒ ì†¡ë…„íšŒ</span>
            </div>
            <div class="flex gap-2">
                <button id="captureToggle" 
                        onclick="captureMode()" 
                        class="bg-blue-600 hover:bg-blue-700 text-white px-3 py-1 rounded-lg text-sm font-medium transition-colors"
                        title="ìº¡ì²˜ ëª¨ë“œë¡œ ì „í™˜">ğŸ“±</button>
            </div>
        </div>
    </nav>

    <div class="max-w-md mx-auto pt-16">
        <!-- ë©”ì¸ ì´ˆëŒ€ì¥ -->
        <div class="invitation-card rounded-2xl p-6 mb-6 text-white text-center relative overflow-hidden">
            <!-- ë°°ê²½ ì¥ì‹ -->
            <div class="absolute top-0 right-0 w-24 h-24 bg-yellow-400 rounded-full opacity-20 -mr-12 -mt-12"></div>
            <div class="absolute bottom-0 left-0 w-16 h-16 bg-pink-400 rounded-full opacity-20 -ml-8 -mb-8"></div>
            
            <div class="relative z-10">
                <!-- ë¡œê³  -->
                <div class="mb-4">
                    <img src="images/osan_log3.svg" alt="ì˜¤ì‚°ê³ ë“±í•™êµ ë¡œê³ " class="w-16 h-16 mx-auto">
                </div>
                
                <!-- ì œëª© -->
                <h1 class="text-2xl font-bold mb-2 text-blue-100">ì˜¤ì‚°ê³  71íšŒ</h1>
                <h2 class="text-xl font-semibold mb-4 text-purple-200">ë™ê¸° ì†¡ë…„íšŒ</h2>
                
                <!-- ì¸ì‚¬ë§ -->
                <p class="text-sm text-blue-100 mb-1">ì˜¤ëœ ë²—ë‹˜ ë” ì¢‹ì€ ìš°ë¦¬,</p>
                <p class="text-sm text-blue-100 mb-6">2025ë…„ì˜ ëìë½ì„ í•¨ê»˜ ë§ˆë¬´ë¦¬í•´ìš”.</p>
            </div>
        </div>

        <!-- í–‰ì‚¬ ì•ˆë‚´ -->
        <section class="event-detail rounded-xl p-4 mb-4 text-white">
            <h3 class="text-lg font-bold mb-3 text-blue-300 flex items-center gap-2">
                ğŸ“… í–‰ì‚¬ ì•ˆë‚´
            </h3>
            <div class="space-y-2 text-sm">
                <div class="flex items-center gap-3">
                    <span class="text-blue-400 font-medium w-8">ì¼ì‹œ:</span>
                    <span>2025ë…„ 11ì›” 29ì¼(í† ) 14:00</span>
                </div>
                <div class="flex items-center gap-3">
                    <span class="text-blue-400 font-medium w-8">ì¥ì†Œ:</span>
                    <span>ì„œìš¸ëŒ€ì…êµ¬ì—­ <span class="text-yellow-300 font-semibold">ê¼¬ê¼¬ë‹­ê°ˆë¹„</span></span>
                </div>
                <div class="flex items-center gap-3">
                    <span class="text-blue-400 font-medium w-8">ì¸ì›:</span>
                    <span>ì•½ 54ëª… ì˜ˆì •</span>
                </div>
            </div>
        </section>

        <!-- ì§„í–‰ í”„ë¡œê·¸ë¨ -->
        <section class="event-detail rounded-xl p-4 mb-4 text-white">
            <h3 class="text-lg font-bold mb-3 text-yellow-300 flex items-center gap-2">
                ğŸŠ ì§„í–‰ í”„ë¡œê·¸ë¨
            </h3>
            <div class="space-y-1 text-sm">
                <div class="program-item p-2 rounded">â€¢ ì…ì¥ & ì¶œì„ì²´í¬ / ê°œíšŒ ì¸ì‚¬</div>
                <div class="program-item p-2 rounded">â€¢ ì†Œëª¨ì„ ì†Œê°œ & ëŒ€í‘œ ì¸ì‚¬ë§</div>
                <div class="program-item p-2 rounded">â€¢ ê±´ë°°ì‚¬ í›„ ì‹ì‚¬ & ììœ  ëŒ€í™”</div>
                <div class="program-item p-2 rounded">â€¢ ë‹¨ì²´ì‚¬ì§„ ì´¬ì˜ ë° ííšŒ</div>
            </div>
        </section>

        <!-- QR ì²´í¬ì¸ -->
        <div class="bg-gradient-to-br from-blue-800 via-slate-800 to-slate-900 rounded-xl p-3 mb-4">
            <div class="flex items-center gap-3">
                <div class="w-18 h-18 bg-white rounded-lg flex items-center justify-center p-1 relative">
                    <canvas id="qrcode" class="w-full h-full" style="display: none;"></canvas>
                    <img id="qrcode-fallback" class="w-full h-full object-contain rounded bg-gray-100" style="display: block;" alt="">
                </div>
                <div class="text-slate-200">
                    <div class="font-bold text-sm text-blue-200 mb-1">QR ì°ê³  ë¯¸ë¦¬ ì²´í¬ì¸</div>
                    <div class="text-xs leading-relaxed">
                        íœ´ëŒ€í° ì¹´ë©”ë¼ë¡œ QRì„ ë¹„ì¶”ë©´<br>
                        í–‰ì‚¬ ì•ˆë‚´ì™€ ì¶œì„ ì²´í¬ë¥¼<br>
                        í•œ ë²ˆì— í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤
                    </div>
                </div>
            </div>
        </div>

        <!-- íŠ¹ë³„ ì•ˆë‚´ -->
        <div class="bg-gradient-to-r from-yellow-500 to-orange-500 rounded-xl p-4 mb-4 text-white text-center">
            <div class="flex items-center justify-center gap-2 mb-2">
                <span class="text-xl">â­</span>
                <span class="font-bold text-sm">"ì˜¤ë˜ ë³´ë‹ˆ ì¢‹ê³ , ì•ìœ¼ë¡œ ë” ì¢‹ì•„ì§ˆ ìš°ë¦¬"</span>
                <span class="text-xl">â­</span>
            </div>
            <div class="text-xs opacity-90">
                11ì›” 29ì¼, ì„œìš¸ëŒ€ì…êµ¬ì—­ ê¼¬ê¼¬ë‹­ê°ˆë¹„ì—ì„œ ë§Œë‚˜ìš”!
            </div>
        </div>

        <!-- ë²„íŠ¼ë“¤ -->
        <div class="text-center">
            <div class="flex gap-3 mb-6">
                <button onclick="window.location.href='/checkin'" 
                        class="flex-1 bg-gradient-to-r from-green-500 to-green-600 hover:from-green-600 hover:to-green-700 text-white font-bold py-3 px-4 rounded-xl text-sm transition-all duration-200 shadow-lg">
                    ğŸ“ ì²´í¬ì¸
                </button>
                <button onclick="window.location.href='/admin'" 
                        class="flex-1 bg-gradient-to-r from-purple-500 to-purple-600 hover:from-purple-600 hover:to-purple-700 text-white font-bold py-3 px-4 rounded-xl text-sm transition-all duration-200 shadow-lg">
                    ğŸ“Š ê´€ë¦¬ìš©
                </button>
            </div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            console.log('ğŸ‰ ì˜¤ì‚°ê³  71íšŒ ì†¡ë…„íšŒ ì´ˆëŒ€ì¥ ë¡œë“œë¨');

            // ìºì‹œ ë²„ì „ ì²´í¬
            function checkCacheVersion() {
                const currentVersion = 'v2.2.0';
                const storedVersion = localStorage.getItem('invitationVersion');
                
                if (storedVersion !== currentVersion) {
                    console.log('ìƒˆ ë²„ì „ ê°ì§€, ìºì‹œ ì—…ë°ì´íŠ¸:', currentVersion);
                    localStorage.setItem('invitationVersion', currentVersion);
                    
                    // ìºì‹œ ë¬´íš¨í™”ë¥¼ ìœ„í•œ ë¦¬ë¡œë“œ (í•œ ë²ˆë§Œ)
                    if (!sessionStorage.getItem('versionUpdated')) {
                        sessionStorage.setItem('versionUpdated', 'true');
                        setTimeout(() => {
                            window.location.reload(true);
                        }, 100);
                        return;
                    }
                }
            }
            
            // ì£¼ê¸°ì  ìºì‹œ ì²´í¬
            setInterval(checkCacheVersion, 3000);
            
            // QR ì½”ë“œ ìƒì„±
            const canvas = document.getElementById('qrcode');
            const fallbackImg = document.getElementById('qrcode-fallback');
            
            if (!canvas || !fallbackImg) {
                console.error('QRì½”ë“œ ìš”ì†Œë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
                return;
            }

            // ì²´í¬ì¸ URL ìƒì„± (ëª¨ë°”ì¼ ì ‘ê·¼ ê°€ëŠ¥)
            let checkinUrl;
            if (window.location.hostname === 'localhost' || window.location.hostname === '127.0.0.1') {
                // ë¡œì»¬ ì„œë²„ì¸ ê²½ìš° - ì‚¬ìš©ìê°€ ì§ì ‘ IPë¥¼ í™•ì¸í•  ìˆ˜ ìˆë„ë¡ ì•ˆë‚´
                const currentUrl = window.location.href;
                checkinUrl = currentUrl.replace('invitation.html', 'checkin.html');
                
                // ì½˜ì†”ê³¼ í™”ë©´ì— ëª¨ë°”ì¼ ì ‘ê·¼ ë°©ë²• ì•ˆë‚´
                console.log('ğŸ“± ëª¨ë°”ì¼ì—ì„œ QRì½”ë“œ ìŠ¤ìº”ì´ ì•ˆ ë  ê²½ìš°:');
                console.log('1. ì»´í“¨í„° IP ì£¼ì†Œ í™•ì¸: ipconfig (Windows) ë˜ëŠ” ifconfig (Mac/Linux)');
                console.log('2. ëª¨ë°”ì¼ì—ì„œ http://[ì»´í“¨í„°IP]:8080/checkin.html ì§ì ‘ ì ‘ì†');
                console.log('3. ì˜ˆ: http://192.168.1.100:8080/checkin.html');
            } else {
                // ë°°í¬ëœ ì„œë²„ì¸ ê²½ìš° ê¹”ë”í•œ URL ì‚¬ìš©
                checkinUrl = window.location.origin + '/checkin';
            }
            console.log('QRì½”ë“œ URL:', checkinUrl);
            
            // QRì½”ë“œ ìƒì„± ë° í‘œì‹œ
            generateQRCode(checkinUrl);

            function generateQRCode(url) {
                console.log('ğŸ”— QR ì½”ë“œ ìƒì„±:', url);
                
                // ìš”ì†Œ ë‹¤ì‹œ ê°€ì ¸ì˜¤ê¸°
                const canvas = document.getElementById('qrcode');
                const fallbackImg = document.getElementById('qrcode-fallback');
                
                if (!fallbackImg) {
                    console.error('QR ì´ë¯¸ì§€ ìš”ì†Œë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
                    return;
                }
                
                const qrApiUrl = `https://api.qrserver.com/v1/create-qr-code/?size=200x200&margin=3&data=${encodeURIComponent(url)}`;
                
                // QR ì´ë¯¸ì§€ ì¦‰ì‹œ ì„¤ì • (ë¡œë”© ì—†ì´)
                fallbackImg.src = qrApiUrl;
                fallbackImg.style.display = 'block';
                if (canvas) canvas.style.display = 'none';
                
                // ì—ëŸ¬ ì‹œ ëŒ€ì²´ ì²˜ë¦¬
                fallbackImg.onerror = function() {
                    console.log('QR ì„œë¹„ìŠ¤ ì‹¤íŒ¨, Google Charts ì‹œë„');
                    const altUrl = `https://chart.googleapis.com/chart?chs=200x200&cht=qr&chl=${encodeURIComponent(url)}`;
                    fallbackImg.src = altUrl;
                    
                    // ë‘ ë²ˆì§¸ë„ ì‹¤íŒ¨í•˜ë©´ ë²„íŠ¼ìœ¼ë¡œ ëŒ€ì²´
                    fallbackImg.onerror = function() {
                        const container = fallbackImg.parentElement;
                        container.innerHTML = `
                            <div class="w-full h-full bg-gradient-to-br from-green-500 to-green-600 rounded-lg flex flex-col items-center justify-center text-white cursor-pointer hover:from-green-600 hover:to-green-700 transition-all" 
                                 onclick="window.location.href='/checkin'">
                                <div class="text-xl">ğŸ“±</div>
                                <div class="text-sm font-bold">ì²´í¬ì¸</div>
                            </div>
                        `;
                    };
                };
                
                // í´ë¦­ ì´ë²¤íŠ¸
                fallbackImg.onclick = function() {
                    window.location.href = '/checkin';
                };
                fallbackImg.style.cursor = 'pointer';
                fallbackImg.title = 'í´ë¦­í•˜ì—¬ ì²´í¬ì¸';
            }
        }); // DOMContentLoaded ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ë‹«ê¸°

        // ìº¡ì²˜ ëª¨ë“œ - ì•ˆì „í•˜ê²Œ ë¶„ë¦¬ëœ ê¸°ëŠ¥
        function captureMode() {
            try {
                const nav = document.querySelector('nav');
                const buttons = document.querySelector('.text-center .flex');
                const toggleBtn = document.getElementById('captureToggle');
            
                if (!nav || !toggleBtn) {
                    console.warn('ìº¡ì²˜ ëª¨ë“œ: ì¼ë¶€ ìš”ì†Œë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
                    return;
                }
            
                if (nav.style.display === 'none') {
                    // ì›ë˜ ìƒíƒœë¡œ ë³µì›
                    nav.style.display = 'block';
                    if (buttons) buttons.style.display = 'flex';
                    toggleBtn.innerHTML = 'ğŸ“±';
                    toggleBtn.title = 'ìº¡ì²˜ ëª¨ë“œë¡œ ì „í™˜';
                    
                    // í† ìŠ¤íŠ¸ ë©”ì‹œì§€ í‘œì‹œ
                    showToast('âœ… ì¼ë°˜ ëª¨ë“œë¡œ ì „í™˜ë˜ì—ˆìŠµë‹ˆë‹¤', 'green');
                } else {
                    // ìº¡ì²˜ ëª¨ë“œë¡œ ì „í™˜
                    nav.style.display = 'none';
                    if (buttons) buttons.style.display = 'none';
                    toggleBtn.innerHTML = 'ğŸ”„';
                    toggleBtn.title = 'ì¼ë°˜ ëª¨ë“œë¡œ ë³µì›';
                    
                    // í† ìŠ¤íŠ¸ ë©”ì‹œì§€ í‘œì‹œ
                    showToast('ğŸ“¸ ìº¡ì²˜ ëª¨ë“œ í™œì„±í™”! ìŠ¤í¬ë¦°ìƒ·ì„ ì°ìœ¼ì„¸ìš”', 'purple');
                }
            } catch (error) {
                console.error('ìº¡ì²˜ ëª¨ë“œ ì˜¤ë¥˜:', error);
                showToast('âŒ ìº¡ì²˜ ëª¨ë“œ ì‹¤í–‰ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤', 'red');
            }
        }
        
        // í† ìŠ¤íŠ¸ ë©”ì‹œì§€ í‘œì‹œ í•¨ìˆ˜
        function showToast(message, color) {
            const toast = document.createElement('div');
            toast.className = `fixed top-16 right-4 bg-${color}-500 text-white px-4 py-2 rounded-lg text-sm z-50 transition-all duration-300`;
            toast.textContent = message;
            document.body.appendChild(toast);
            
            setTimeout(() => {
                toast.style.opacity = '0';
                setTimeout(() => {
                    if (document.body.contains(toast)) {
                        document.body.removeChild(toast);
                    }
                }, 300);
            }, 2500);
        }
    </script>
</body>
</html>