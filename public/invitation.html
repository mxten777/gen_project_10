<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <meta name="version" content="v2.1.0">
    <title>ì˜¤ì‚°ê³ ë“±í•™êµ 71íšŒ ë™ê¸° ì†¡ë…„íšŒ ì´ˆëŒ€ì¥</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="min-h-screen bg-gradient-to-br from-blue-900 via-blue-700 to-slate-900">
    <!-- ë„¤ë¹„ê²Œì´ì…˜ ë°” -->
    <nav class="fixed top-0 left-0 right-0 z-50 bg-black bg-opacity-80 backdrop-blur-md border-b border-slate-600 shadow-lg">
        <div class="max-w-7xl mx-auto px-2 sm:px-4">
            <div class="flex justify-between items-center h-16">
                <div class="flex items-center space-x-2 sm:space-x-4">
                    <img src="images/osan_log3.svg" alt="ì˜¤ì‚°ê³  ë¡œê³ " class="w-8 h-8 sm:w-12 sm:h-12 object-contain">
                    <h1 class="text-white font-bold text-sm sm:text-lg drop-shadow-sm">ì˜¤ì‚°ê³  71íšŒ ì†¡ë…„íšŒ</h1>
                </div>
                <div class="flex space-x-2">
                    <a href="invitation.html" class="px-3 py-2 sm:px-4 sm:py-2 rounded-lg text-xs sm:text-sm font-semibold bg-blue-600 text-white shadow-sm min-w-[44px] text-center">
                        ğŸŠ <span class="hidden sm:inline">ì´ˆëŒ€ì¥</span>
                    </a>
                    <a href="checkin.html" class="px-3 py-2 sm:px-4 sm:py-2 rounded-lg text-xs sm:text-sm font-semibold text-slate-200 hover:text-white hover:bg-slate-700 transition-colors min-w-[44px] text-center">
                        ğŸ“ <span class="hidden sm:inline">ì²´í¬ì¸</span>
                    </a>
                </div>
            </div>
        </div>
    </nav>

    <div class="pt-16 min-h-screen flex items-center justify-center px-2 py-2 sm:px-4">
        <main class="w-full max-w-lg bg-gradient-to-br from-blue-800 via-purple-900 to-blue-700 bg-opacity-95 rounded-2xl shadow-2xl border border-blue-700 px-4 py-6 sm:px-8 sm:py-10">
            <!-- í—¤ë” -->
            <div class="flex items-center justify-between mb-4">
                <div class="px-2 py-0.5 rounded-full border border-blue-400 text-xs text-blue-200 uppercase tracking-wider bg-gradient-to-r from-blue-500 to-purple-600">INVITATION</div>
                <img src="images/osan_log3.svg" alt="ì˜¤ì‚°ê³  ë¡œê³ " class="w-12 h-12 object-contain">
            </div>

            <!-- ì œëª© -->
            <div class="text-center mb-6">
                <h1 class="text-3xl sm:text-5xl font-extrabold text-blue-200 mb-2">ì˜¤ì‚°ê³  71íšŒ</h1>
                <h2 class="text-4xl sm:text-6xl font-extrabold text-blue-300">ë™ê¸° ì†¡ë…„íšŒ</h2>
            </div>

            <!-- ë¶€ì œëª© -->
            <div class="text-center text-lg text-slate-200 mb-6 font-medium">
                ì˜¤ë˜ ë³´ë‹ˆ ë” ì¢‹ì€ ìš°ë¦¬,<br>2025ë…„ì˜ ëìë½ì„ í•¨ê»˜ ë§ˆë¬´ë¦¬í•´ìš”.
            </div>

            <!-- êµ¬ë¶„ì„  -->
            <div class="h-px bg-gradient-to-r from-transparent via-slate-500 to-transparent my-4"></div>
            <div class="h-1 bg-gradient-to-r from-blue-400 via-purple-400 to-blue-400 rounded-full my-4"></div>

            <!-- í–‰ì‚¬ ì•ˆë‚´ -->
            <section class="mb-6">
                <h3 class="text-xl font-semibold text-blue-200 mb-3">ğŸ“… í–‰ì‚¬ ì•ˆë‚´</h3>
                <div class="text-slate-200 space-y-2">
                    <div><span class="text-slate-400">ì¼ì‹œ:</span> 2025ë…„ 11ì›” 29ì¼(í† ) 14:00 ~ 17:00</div>
                    <div><span class="text-slate-400">ì¥ì†Œ:</span> ì„œìš¸ëŒ€ì…êµ¬ì—­ <span class="font-bold text-yellow-300">ê¼¬ê¼¬ë‹­ê°ˆë¹„</span></div>
                    <div><span class="text-slate-400">ì¸ì›:</span> ì•½ 54ëª… ì˜ˆì •</div>
                </div>
            </section>

            <!-- í”„ë¡œê·¸ë¨ -->
            <section class="mb-6">
                <h3 class="text-xl font-semibold text-blue-200 mb-3">ğŸ‰ ì£¼ìš” ìˆœì„œ</h3>
                <div class="text-sm text-slate-300 space-y-1">
                    <div>â€¢ ì…ì¥ & ì¶œì„ì²´í¬ / ê°œíšŒ & ì‚¬íšŒì ì¸ì‚¬</div>
                    <div>â€¢ ì†Œëª¨ì„ ì†Œê°œ ë° í›„ì›ì ì†Œê°œ</div>
                    <div>â€¢ ë™ê¸° ëŒ€í‘œ ì¸ì‚¬ë§ & êµê°€ ì œì°½</div>
                    <div>â€¢ ê±´ë°°ì‚¬ í›„ ì‹ì‚¬ & ììœ  ëŒ€í™”</div>
                    <div>â€¢ ë‹¨ì²´ì‚¬ì§„ ì´¬ì˜ ë° ííšŒ ì•ˆë‚´</div>
                </div>
            </section>

            <!-- QR ì²´í¬ì¸ -->
            <div class="bg-gradient-to-br from-blue-800 via-slate-800 to-slate-900 rounded-2xl p-4 mb-6">
                <div class="flex items-center gap-4">
                    <div class="w-20 h-20 bg-white rounded-lg flex items-center justify-center p-1">
                        <canvas id="qrcode" class="w-full h-full"></canvas>
                        <img id="qrcode-fallback" style="display: none;" class="w-full h-full object-contain" alt="QRì½”ë“œ">
                    </div>
                    <div class="text-slate-200">
                        <div class="font-bold text-lg text-blue-200 mb-1">QR ì°ê³  ë¯¸ë¦¬ ì²´í¬ì¸í•´ ì£¼ì„¸ìš”</div>
                        <div class="text-sm leading-relaxed">
                            íœ´ëŒ€í° ì¹´ë©”ë¼ë¡œ QRì„ ë¹„ì¶”ë©´<br>
                            í–‰ì‚¬ ì•ˆë‚´ì™€ ì¶œì„ ì²´í¬ë¥¼<br>
                            í•œ ë²ˆì— í™•ì¸í•˜ì‹¤ ìˆ˜ ìˆìŠµë‹ˆë‹¤
                        </div>
                        <div class="text-xs text-slate-400 mt-2 border-t border-slate-600 pt-2">
                            ğŸ’¡ QRì½”ë“œê°€ ì•ˆ ë  ê²½ìš° í´ë¦­í•˜ì„¸ìš”
                        </div>
                    </div>
                </div>
            </div>

            <!-- í‘¸í„° -->
            <div class="text-center">
                <div class="text-lg text-yellow-300 font-semibold mb-2">
                    âœ¨ "ì˜¤ë˜ ë³´ë‹ˆ ì¢‹ê³ , ì•ìœ¼ë¡œ ë” ì¢‹ì•„ì§ˆ ìš°ë¦¬"
                </div>
                <div class="text-sm text-slate-400">
                    11ì›” 29ì¼, ì„œìš¸ëŒ€ì…êµ¬ì—­ ê¼¬ê¼¬ë‹­ê°ˆë¹„ì—ì„œ ë°˜ê°€ìš´ ì–¼êµ´ë¡œ ëµ™ê² ìŠµë‹ˆë‹¤.
                </div>
            </div>

            <!-- ë„¤ë¹„ê²Œì´ì…˜ ë²„íŠ¼ -->
            <div class="mt-8 pt-6 border-t border-slate-600">
                <div class="flex gap-2">
                    <button onclick="window.location.href='invitation.html'" class="flex-1 bg-blue-600 hover:bg-blue-700 text-white py-2 px-4 rounded-lg text-sm">
                        ğŸŠ ì´ˆëŒ€ì¥
                    </button>
                    <button onclick="window.location.href='checkin.html'" class="w-full bg-green-600 hover:bg-green-700 text-white py-3 px-6 rounded-lg text-lg font-semibold">
                        ğŸ“ ì²´í¬ì¸ í•˜ëŸ¬ ê°€ê¸°
                    </button>
                </div>
            </div>
        </main>
    </div>

    <script>
        // ê°•ë ¥í•œ ìºì‹œ ë²„ì „ ì²´í¬ ë° ìƒˆë¡œê³ ì¹¨ ê¸°ëŠ¥
        function checkCacheVersion() {
            const currentVersion = localStorage.getItem('cacheVersion');
            const pageVersion = sessionStorage.getItem('pageVersion');
            const forceReload = localStorage.getItem('forceReload');
            
            // ê°•ì œ ë¦¬ë¡œë“œ í”Œë˜ê·¸ê°€ ìˆìœ¼ë©´ ì¦‰ì‹œ ë¦¬ë¡œë“œ
            if (forceReload === 'true') {
                localStorage.removeItem('forceReload');
                const url = new URL(window.location.href);
                url.searchParams.set('_cache', Date.now());
                window.location.replace(url.toString());
                return;
            }
            
            if (currentVersion && currentVersion !== pageVersion) {
                sessionStorage.setItem('pageVersion', currentVersion);
                console.log('ìºì‹œ ì—…ë°ì´íŠ¸ ê°ì§€ - í˜ì´ì§€ ìƒˆë¡œê³ ì¹¨');
                location.reload(true); // ê°•ì œ ë¦¬ë¡œë“œ
            }
        }

        // QRì½”ë“œ ìƒì„±
        document.addEventListener('DOMContentLoaded', function() {
            // ì´ˆê¸° ìºì‹œ ë²„ì „ ì„¤ì •
            if (!sessionStorage.getItem('pageVersion')) {
                sessionStorage.setItem('pageVersion', Date.now().toString());
            }
            
            // ì£¼ê¸°ì  ìºì‹œ ì²´í¬
            setInterval(checkCacheVersion, 3000);
            const canvas = document.getElementById('qrcode');
            const fallbackImg = document.getElementById('qrcode-fallback');
            
            if (!canvas || !fallbackImg) {
                console.error('QRì½”ë“œ ìš”ì†Œë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
                return;
            }

            // ì²´í¬ì¸ URL ìƒì„± (ëª¨ë°”ì¼ ì ‘ê·¼ ê°€ëŠ¥)
            let checkinUrl;
            if (window.location.hostname === 'localhost' || window.location.hostname === '127.0.0.1') {
                // ë¡œì»¬ ì„œë²„ì¸ ê²½ìš° - ì‹¤ì œ IP ì£¼ì†Œë¡œ QR ì½”ë“œ ìƒì„±
                const port = window.location.port || '8080';
                
                // ê°ì§€ëœ ì‹¤ì œ IP ì£¼ì†Œ ì‚¬ìš©
                const localIP = '192.168.45.14';  // ipconfigì—ì„œ í™•ì¸ëœ IP
                checkinUrl = `http://${localIP}:${port}/checkin.html`;
                
                // ëª¨ë°”ì¼ ì ‘ê·¼ ë°©ë²• ì•ˆë‚´
                console.log('ğŸ“± ëª¨ë°”ì¼ QR ìŠ¤ìº” ì•ˆë‚´:');
                console.log('1. ì»´í“¨í„°ì™€ ëª¨ë°”ì¼ì´ ê°™ì€ WiFiì— ì—°ê²°ë˜ì–´ ìˆëŠ”ì§€ í™•ì¸');
                console.log('2. QR ì½”ë“œ URL:', checkinUrl);
                console.log('3. QR ìŠ¤ìº”ì´ ì•ˆë˜ë©´ ëª¨ë°”ì¼ì—ì„œ ì§ì ‘ URL ì…ë ¥');
                
                // í˜ì´ì§€ì— ëª¨ë°”ì¼ ì ‘ê·¼ ë§í¬ í‘œì‹œ
                displayMobileAccessInfo(checkinUrl);
                
            } else {
                // ë°°í¬ëœ ì„œë²„ì¸ ê²½ìš° ì›ë˜ ë°©ì‹ ì‚¬ìš©
                checkinUrl = window.location.origin + window.location.pathname.replace('invitation.html', 'checkin.html');
            }
            console.log('QRì½”ë“œ URL:', checkinUrl);
            
            // ì™¸ë¶€ APIë¡œ QRì½”ë“œ ìƒì„±
            generateQRWithAPI(checkinUrl);

            // ëª¨ë°”ì¼ ì ‘ê·¼ ì •ë³´ í‘œì‹œ í•¨ìˆ˜
            function displayMobileAccessInfo(url) {
                const infoDiv = document.createElement('div');
                infoDiv.className = 'mt-4 p-3 bg-blue-700 bg-opacity-50 rounded-lg text-xs text-blue-200';
                infoDiv.innerHTML = `
                    <div class="font-semibold mb-1">ğŸ“± ëª¨ë°”ì¼ ì§ì ‘ ì ‘ì†:</div>
                    <div class="break-all text-blue-300 font-mono text-xs">${url}</div>
                    <div class="mt-1 text-xs opacity-80">QR ìŠ¤ìº”ì´ ì•ˆë˜ë©´ ìœ„ ë§í¬ë¥¼ ëª¨ë°”ì¼ ë¸Œë¼ìš°ì €ì— ì…ë ¥í•˜ì„¸ìš”</div>
                `;
                
                // QR ì˜ì—­ ë‹¤ìŒì— ì¶”ê°€
                const qrSection = document.querySelector('.bg-gradient-to-br.from-blue-800');
                if (qrSection) {
                    qrSection.appendChild(infoDiv);
                }
            }

            function generateQRWithAPI(url) {
                const qrApiUrl = `https://api.qrserver.com/v1/create-qr-code/?size=74x74&margin=1&data=${encodeURIComponent(url)}`;
                
                fallbackImg.src = qrApiUrl;
                fallbackImg.style.display = 'block';
                canvas.style.display = 'none';
                
                fallbackImg.onload = function() {
                    console.log('âœ… QRì½”ë“œ ìƒì„± ì„±ê³µ!');
                    showSuccessMessage('QR ì½”ë“œê°€ ì„±ê³µì ìœ¼ë¡œ ìƒì„±ë˜ì—ˆìŠµë‹ˆë‹¤');
                };
                
                fallbackImg.onerror = function() {
                    console.error('âŒ QRì½”ë“œ ìƒì„± ì‹¤íŒ¨, ëŒ€ì²´ UIë¡œ êµì²´');
                    
                    // Google Charts APIë¡œ ì¬ì‹œë„
                    const googleQR = `https://chart.googleapis.com/chart?chs=74x74&cht=qr&chl=${encodeURIComponent(url)}`;
                    const retryImg = new Image();
                    
                    retryImg.onload = function() {
                        fallbackImg.src = googleQR;
                        console.log('âœ… Google Charts QR ìƒì„± ì„±ê³µ');
                    };
                    
                    retryImg.onerror = function() {
                        // ëª¨ë“  QR ì„œë¹„ìŠ¤ ì‹¤íŒ¨ ì‹œ ëŒ€ì²´ UI
                        canvas.parentElement.innerHTML = `
                            <div class="w-full h-full bg-gradient-to-br from-green-500 to-blue-500 rounded-lg flex flex-col items-center justify-center text-white cursor-pointer hover:from-green-600 hover:to-blue-600 transition-all p-2" 
                                 onclick="window.location.href='checkin.html'"
                                 title="QR ì½”ë“œë¥¼ ìƒì„±í•  ìˆ˜ ì—†ì–´ ì§ì ‘ ë§í¬ë¥¼ ì œê³µí•©ë‹ˆë‹¤">
                                <div class="text-2xl mb-1">ğŸ“±</div>
                                <div class="text-xs font-bold">ì²´í¬ì¸</div>
                                <div class="text-xs opacity-80">ì§ì ‘ ì´ë™</div>
                            </div>
                        `;
                        showErrorMessage('QR ì½”ë“œ ìƒì„±ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. ë²„íŠ¼ì„ í´ë¦­í•˜ì—¬ ì²´í¬ì¸í•˜ì„¸ìš”.');
                    };
                    
                    retryImg.src = googleQR;
                };

                // í´ë¦­ ì‹œ ì²´í¬ì¸ í˜ì´ì§€ë¡œ ì´ë™
                fallbackImg.onclick = function() {
                    window.location.href = 'checkin.html';
                };
                fallbackImg.style.cursor = 'pointer';
                fallbackImg.title = 'í´ë¦­í•˜ì—¬ ì²´í¬ì¸ í˜ì´ì§€ë¡œ ì´ë™';
            }
        });
        
        // ì„±ê³µ ë©”ì‹œì§€ í‘œì‹œ í•¨ìˆ˜
        function showSuccessMessage(message) {
            showToastMessage(message, 'success');
        }
        
        // ì—ëŸ¬ ë©”ì‹œì§€ í‘œì‹œ í•¨ìˆ˜  
        function showErrorMessage(message) {
            showToastMessage(message, 'error');
        }
        
        // í† ìŠ¤íŠ¸ ë©”ì‹œì§€ í†µí•© í•¨ìˆ˜
        function showToastMessage(message, type = 'info') {
            const existingToast = document.querySelector('.toast-message');
            if (existingToast) {
                existingToast.remove();
            }
            
            const colors = {
                success: 'bg-green-600',
                error: 'bg-red-600', 
                info: 'bg-blue-600'
            };
            
            const toast = document.createElement('div');
            toast.className = `toast-message fixed top-20 left-1/2 transform -translate-x-1/2 ${colors[type]} text-white px-4 py-2 rounded-lg shadow-lg z-50 text-sm max-w-xs text-center`;
            toast.textContent = message;
            
            document.body.appendChild(toast);
            
            // í˜ì´ë“œ ì¸ íš¨ê³¼
            setTimeout(() => {
                toast.style.opacity = '1';
            }, 100);
            
            // ìë™ ì œê±°
            setTimeout(() => {
                toast.style.opacity = '0';
                setTimeout(() => {
                    if (document.body.contains(toast)) {
                        document.body.removeChild(toast);
                    }
                }, 300);
            }, type === 'error' ? 4000 : 2000);
        }
    </script>
</body>
</html>